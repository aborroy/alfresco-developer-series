
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Tutorials and best practices for Alfresco developers">
      
      
      
      
        <link rel="prev" href="../../../content/tutorial/tutorial/">
      
      
        <link rel="next" href="../../../behaviors/tutorial/tutorial/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.20">
    
    
      
        <title>Actions - Alfresco Developer Series</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.e53b48f4.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#creating-custom-actions-in-alfresco" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Alfresco Developer Series" class="md-header__button md-logo" aria-label="Alfresco Developer Series" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Alfresco Developer Series
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Actions
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/aborroy/alfresco-developer-series" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Alfresco Developer Series" class="md-nav__button md-logo" aria-label="Alfresco Developer Series" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Alfresco Developer Series
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/aborroy/alfresco-developer-series" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Tutorials
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../maven-sdk/tutorial/tutorial/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Maven SDK
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../content/tutorial/tutorial/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content Types & CMIS
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Actions
    
  </span>
  

      </a>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../behaviors/tutorial/tutorial/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Behaviors
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../webscripts/tutorial/tutorial/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    WebScripts
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../workflow/tutorial/tutorial/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Workflows
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="creating-custom-actions-in-alfresco">Creating Custom Actions in Alfresco<a class="headerlink" href="#creating-custom-actions-in-alfresco" title="Permanent link">&para;</a></h1>
<p><em>Jeff Potts, <a href="https://www.metaversant.com">Metaversant Group</a> — July, 2021</em></p>
<h1 id="license">License<a class="headerlink" href="#license" title="Permanent link">&para;</a></h1>
<p><img alt="" src="../images/cc-by-sa-88x31.png" /></p>
<p>This work is licensed under the Creative Commons Attribution-ShareAlike 3.0 Unported License. To view a copy of this license, visit http://creativecommons.org/licenses/by-sa/3.0/ or send a letter to Creative Commons, 444 Castro Street, Suite 900, Mountain View, California, 94041, USA.</p>
<h1 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">&para;</a></h1>
<p>Alfresco is a flexible platform for developing content management
applications. Clients have several options to consider when selecting a
user interface approach. Alfresco comes with a web client, Alfresco Share, that
can be used as-is or customized. Alternatively, developers can create custom
applications using the Content Management Interoperability Services (CMIS) API,
web scripts, or the Alfresco Application Development Framework (ADF).</p>
<p>Many times, the out-of-the-box web client is sufficient, even if it has
to be customized slightly to fit your requirements. This is particularly
true when your requirements closely resemble the all-purpose document
management use case.</p>
<p>Deciding whether to go with the out-of-the-box web client, a customized
web client, or building your own user interface from scratch requires
careful thought and analysis that is beyond the scope of this document.</p>
<p>This tutorial is part of a <a href="https://ecmarchitect.com/alfresco-developer-series">series of tutorials</a>
that cover Alfresco from a configuration and customization perspective. The
<a href="https://ecmarchitect.com/alfresco-developer-series-tutorials/content/tutorial/tutorial.html">previous tutorial</a> discussed how to create custom content types and then expose those to the
Alfresco Share user interface. The focus in this tutorial is on developing
custom actions and configuring the user interface to show those custom actions.</p>
<p>It is important to note that if you are looking for quick-and-dirty ways
to operate against documents in the repository, you may not need a
custom action. For example, you could:</p>
<ul>
<li>Write some Java, Groovy, Python, PHP, or .NET code that leverages an Apache
Chemistry library to work with content stored in Alfresco</li>
<li>Create some server-side JavaScript
that gets executed using the <a href="http://share-extras.github.io/addons/js-console/">JavaScript Console</a>
add-on available from Share Extras</li>
<li>Use curl or some other HTTP client to make calls against the Alfresco REST API</li>
<li>Use curl or some other HTTP client to make calls against web scripts</li>
</ul>
<p>None of the above require you to write actions.</p>
<p>Actions are useful when:</p>
<ul>
<li>You want to define one or more operations that can be executed repeatedly</li>
<li>You want to make it easy for end-users to invoke common operations, either by
clicking a menu item or by configuring a rule on a folder that will execute the
operations automatically</li>
<li>You want to perform one or more operations on a schedule (which isn't covered
in this tutorial)</li>
</ul>
<p>Part 1 of this document explains how to implement the “back-end” piece of the
action. The document includes two different examples. One action, called “Move
Replaced” will be used as a “Rule Action”. The other action is called “Set Web
Flag” and it will be called from menu items in the user interface.</p>
<p>Part 2 explains how to configure the Alfresco Share user interface to work with
the custom actions you developed in Part 1.</p>
<h1 id="setup">Setup<a class="headerlink" href="#setup" title="Permanent link">&para;</a></h1>
<p>Before getting too far down the road, let me tell you about the tools you'll
need and then give you a description of the project organization.</p>
<h2 id="tools">Tools<a class="headerlink" href="#tools" title="Permanent link">&para;</a></h2>
<p>Here is what I am using on my machine:</p>
<ul>
<li>MacOS 11.4</li>
<li>Java OpenJDK 11.0.2</li>
<li>Apache Maven 3.8.5</li>
<li>Alfresco Maven SDK 4.2 (No download necessary)</li>
<li>Docker 20.10.6</li>
<li>Docker Compose 1.29.1</li>
</ul>
<p>By default, when you create an Alfresco project using the Alfresco Maven SDK the
project will be configured to depend on the latest stable Alfresco Community
Edition build.</p>
<p>An IDE is optional. Most people working with Alfresco use IntelliJ, Eclipse, or
something similar.</p>
<h2 id="project-organization">Project Organization<a class="headerlink" href="#project-organization" title="Permanent link">&para;</a></h2>
<p>I am going to use the Alfresco Maven SDK to create a project that will package
up my customizations in two AMPs (Alfresco Module Packages). One AMP is for the
Alfresco web application (the "repo" tier) and the other is for the Alfresco
Share web application (the "Share" tier).</p>
<p>I am not going to spend much time talking about how the Alfresco Maven SDK
works. If you aren't already familiar with it, you may want to read the
<a href="https://ecmarchitect.com/alfresco-developer-series">Getting Started with the Alfresco Maven SDK</a>
tutorial on ecmarchitect.com first and then come back to this one.</p>
<p>This tutorial relies on code from the <a href="https://ecmarchitect.com/alfresco-developer-series-tutorials/content/tutorial/tutorial.html">Custom Content Types</a>
tutorial. The tutorial assumes that the repo tier AMP and Share tier AMP created
during that tutorial have been installed into your local Maven repository by
running <code>mvn install</code> from the root of the content-tutorial project.</p>
<p>If, rather than launching your project using the embedded Tomcat server, you are
deploying to a separately installed Alfresco server, you must first deploy the
content-tutorial repo tier and Share tier AMPs before deploying the AMPs you
will create in this tutorial.</p>
<p>If you are planning on following along, go ahead and use the Alfresco Maven SDK
to create a new project from the "all-in-one" archetype. Use a <code>groupId</code> of
"com.someco" and an <code>artifactId</code> of "actions-tutorial".</p>
<p>I'm going to make three quick changes to the initial project files the SDK
created:</p>
<ol>
<li>First, we always want to generate AMP files. Starting with SDK 3.0.0, the
default is to generate only a JAR file. That's easily fixed by uncommenting the
"maven-assembly-plugin" in the list of plugins in the pom.xml file.</li>
<li>
<p>Second, as I just mentioned, the actions tutorial project depends on the
content tutorial project. When we launch the actions-tutorial project's Docker
containers, we want the AMPs from the content tutorial to be installed, so those
need to be set up as dependencies in the pom.xml of the platform docker module:</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;dependencies&gt;</span>
<span class="w">    </span><span class="nt">&lt;dependency&gt;</span>
<span class="w">        </span><span class="nt">&lt;groupId&gt;</span>com.someco<span class="nt">&lt;/groupId&gt;</span>
<span class="w">        </span><span class="nt">&lt;artifactId&gt;</span>actions-tutorial-platform<span class="nt">&lt;/artifactId&gt;</span>
<span class="w">        </span><span class="nt">&lt;version&gt;</span>1.0-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
<span class="w">        </span><span class="nt">&lt;type&gt;</span>amp<span class="nt">&lt;/type&gt;</span>
<span class="w">    </span><span class="nt">&lt;/dependency&gt;</span>
<span class="w">    </span><span class="nt">&lt;dependency&gt;</span>
<span class="w">        </span><span class="nt">&lt;groupId&gt;</span>com.someco<span class="nt">&lt;/groupId&gt;</span>
<span class="w">        </span><span class="nt">&lt;artifactId&gt;</span>content-tutorial-platform<span class="nt">&lt;/artifactId&gt;</span>
<span class="w">        </span><span class="nt">&lt;version&gt;</span>1.0-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
<span class="w">        </span><span class="nt">&lt;type&gt;</span>amp<span class="nt">&lt;/type&gt;</span><span class="w">            </span>
<span class="w">    </span><span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;/dependencies&gt;</span>
</code></pre></div>
<p>And also in the pom.xml of the share docker module:</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;dependencies&gt;</span>
<span class="w">    </span><span class="nt">&lt;dependency&gt;</span>
<span class="w">        </span><span class="nt">&lt;groupId&gt;</span>com.someco<span class="nt">&lt;/groupId&gt;</span>
<span class="w">        </span><span class="nt">&lt;artifactId&gt;</span>actions-tutorial-share<span class="nt">&lt;/artifactId&gt;</span>
<span class="w">        </span><span class="nt">&lt;version&gt;</span>1.0-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
<span class="w">        </span><span class="nt">&lt;type&gt;</span>amp<span class="nt">&lt;/type&gt;</span>
<span class="w">    </span><span class="nt">&lt;/dependency&gt;</span><span class="w">    </span>
<span class="w">    </span><span class="nt">&lt;dependency&gt;</span>
<span class="w">        </span><span class="nt">&lt;groupId&gt;</span>com.someco<span class="nt">&lt;/groupId&gt;</span>
<span class="w">        </span><span class="nt">&lt;artifactId&gt;</span>content-tutorial-share<span class="nt">&lt;/artifactId&gt;</span>
<span class="w">        </span><span class="nt">&lt;version&gt;</span>1.0-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
<span class="w">        </span><span class="nt">&lt;type&gt;</span>amp<span class="nt">&lt;/type&gt;</span>
<span class="w">    </span><span class="nt">&lt;/dependency&gt;</span><span class="w">        </span>
<span class="nt">&lt;/dependencies&gt;</span>
</code></pre></div>
</li>
<li>
<p>Third, not only do we want the content tutorial AMPs installed, but the
actions tutorial actually has a compile-time dependency on that project. So, go
into the "actions-tutorial-platform" directory and add the dependency to the
pom.xml:</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;dependencies&gt;</span>
<span class="w">    </span><span class="nt">&lt;dependency&gt;</span>
<span class="w">        </span><span class="nt">&lt;groupId&gt;</span>com.someco<span class="nt">&lt;/groupId&gt;</span>
<span class="w">        </span><span class="nt">&lt;artifactId&gt;</span>content-tutorial-platform<span class="nt">&lt;/artifactId&gt;</span>
<span class="w">        </span><span class="nt">&lt;version&gt;</span>1.0-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
<span class="w">        </span><span class="nt">&lt;scope&gt;</span>provided<span class="nt">&lt;/scope&gt;</span>
<span class="w">    </span><span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;/dependencies&gt;</span>
</code></pre></div>
</li>
</ol>
<p>Now we're ready to begin.</p>
<h1 id="part-1-implementing-an-action">Part 1: Implementing an Action<a class="headerlink" href="#part-1-implementing-an-action" title="Permanent link">&para;</a></h1>
<p>Actions are very commonly used when implementing Alfresco. This part of
the tutorial explains what actions are, sets up a couple of examples,
then shows how actions are implemented in Java.</p>
<h2 id="what-is-an-action">What is an Action?<a class="headerlink" href="#what-is-an-action" title="Permanent link">&para;</a></h2>
<p>The term, “action” is overloaded quite heavily across the Alfresco
platform (and application development, in general). For the purposes of
this document, an action is a discrete, reusable unit of work that can
be performed against an object in the repository, and can optionally be
configured at run-time by the user. Some of the out-of-the-box actions
include things like: Check-out, Check-in, Add Aspect, Remove Aspect,
Move, Send Email, and Specialize Type.</p>
<p>Sometimes, the term “rule action” is used to describe this type of
action. That's because actions are frequently used when configuring a
rule on a folder. For example, suppose that there is a requirement to
always create a PNG version of GIFs checked in to a specific folder.
This is easily done by creating a rule that watches for new or updated
GIFs and then runs the “Transform and Copy Image” action when it finds
an object that meets the criteria.</p>
<p>The screenshots below show some of the out-of-the-box actions available when
configuring a rule in Alfresco Share:</p>
<p><img alt="Actions in Share rule config" src="../images/rule-actions-share.png" /></p>
<p>But actions aren't limited to running as part of a rule. Actions can be
called from menu items in the Alfresco Share user interface. These are often
called “UI actions” to distinguish the actual menu item, the UI action, from the
thing that actually does the work, the “rule action” or simply, the “action”.</p>
<p>These screenshots show the UI actions available in Alfresco Share's document
library's document list as well as the document details page:</p>
<p><img alt="Browse UI actions in Share" src="../images/ui-actions-browse-share.png" /></p>
<p><img alt="Details UI actions in Share" src="../images/ui-actions-details-share.png" /></p>
<p>So actions can be invoked from a rule and can be triggered from a menu
item. Actions can also be called from code which means they can be
invoked from server-side JavaScript, workflows, web scripts, or any
other piece of code that can get to the Action Service.</p>
<p>Because the same action can be invoked from all of these places, actions
are a powerful way to write content operations once and then leverage
them in many places.</p>
<h3 id="example-1-move-replaced">Example 1: Move Replaced<a class="headerlink" href="#example-1-move-replaced" title="Permanent link">&para;</a></h3>
<p>Using actions and workflow together can be an effective way to customize
the web client for the needs of the business. Consider SomeCo, the
fictitious company introduced in the content types tutorial. Suppose
SomeCo wants to use Alfresco to manage the policies and procedures for
their entire organization. They need to be able to track when a new
policy or procedure is published that supersedes an older policy
document.</p>
<p>SomeCo uses three folders to keep track of the state of their policies:
Draft, Approved, and Archived. SomeCo uses Alfresco's Simple Workflows
to move policies from folder to folder. When someone moves a policy into
the Approved folder, if that policy replaces an older policy, the older
policy needs to be automatically moved to the Archived folder. Alfresco
has a “Move” action, but doesn't have a “Move Replaced” action. A new
“Move Replaced” action can easily be created to accomplish this.</p>
<p>You're going to see how to implement this momentarily.</p>
<h3 id="example-2-set-web-flag">Example 2: Set Web Flag<a class="headerlink" href="#example-2-set-web-flag" title="Permanent link">&para;</a></h3>
<p>Recall from the first tutorial that SomeCo publishes a subset of the
documents in their repository to a company portal. SomeCo uses a flag on
the object to keep track of which documents should be shown on the
portal. In the first tutorial, that flag was set either by editing the
field in the user interface or by running code. Now it is time to make
it a bit more user-friendly by providing menu items in the user
interface that can enable and disable the flag.</p>
<p>The rest of this document explains how to implement both of these
actions including the configuration necessary to make them available
from the Alfresco Share user interface.</p>
<h2 id="implementing-the-move-replaced-action">Implementing the Move Replaced Action<a class="headerlink" href="#implementing-the-move-replaced-action" title="Permanent link">&para;</a></h2>
<p>Actions run against specific nodes. In this example, the action needs to
find the documents that the “actioned upon node” replaces so they can be
moved. In order to do this, the action needs to know where to move the
old documents to and it needs to know how to find the old documents. The
first part, where to move the old documents, will be a parameter that
gets passed to the action. The second part will leverage a “replaces”
relationship.</p>
<p>A "replaces" relationship is a pretty common requirement. In fact,
Alfresco already has a "replaceable" aspect in the out-of-the-box
content model. The “replaceable” aspect defines an association called
“cm:replaces”. So, the out-of-the-box content model already accommodates
documents that replace other documents. All that is needed is some
configuration to expose this relationship to the user interface.</p>
<p>The business logic will reside in an action executer class. This will
allow SomeCo end-users to call the action from a rule configured on any
folder, without further involvement from the development team.</p>
<p>Implementing the action's business logic involves two steps:</p>
<ol>
<li>Writing the action executer class</li>
<li>Configuring the action in Spring</li>
</ol>
<p>Once that's done, the action can be called from code using the Action
Service, or it can be wired in to the user interface (including rule
configuration), which is covered in Part 2.</p>
<h3 id="step-1-write-the-action-executer-class">Step 1: Write the action executer class<a class="headerlink" href="#step-1-write-the-action-executer-class" title="Permanent link">&para;</a></h3>
<p>At its most basic, an action consists of an Action Executer class and
its associated Spring bean configuration. Implementing an action
involves extending <code>ActionExecuterAbstractBase</code> and then implementing the
<code>executeImpl()</code> method. Before starting, though, think about similar code
that might already exist within Alfresco that might be a good starting
point for the new action. Alfresco is open source--it would be a shame
to ignore that valuable resource. Plus, following the same patterns to
implement this customization will make it easier for someone to support
and makes it easier to share our code with others or even to contribute
the code back to the Alfresco community project.</p>
<p>The new action is doing a move, so the existing Move action is a good
place to start. In fact, the only difference between the Move action and
the custom Move Replaced action is that the node being moved isn't the
current node--it's the node on the target end of a "replaces"
association.</p>
<p>Alfresco's executer class for the Move action is called
<code>org.alfresco.repo.action.executer.MoveActionExecuter</code>. If you have the
Alfresco source you can find it in the repository project. I'll copy it
into my own repository project and call it "<a href="https://github.com/jpotts/alfresco-developer-series/blob/master/actions/actions-tutorial/actions-tutorial-platform/src/main/java/com/someco/action/executer/MoveReplacedActionExecuter.java">MoveReplacedActionExecuter</a>".</p>
<p>The out-of-the-box <code>executeImpl()</code> method is where the move logic is handled.
It looks like this:</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">executeImpl</span><span class="p">(</span><span class="n">Action</span><span class="w"> </span><span class="n">ruleAction</span><span class="p">,</span><span class="w"> </span><span class="n">NodeRef</span><span class="w"> </span><span class="n">actionedUponNodeRef</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">NodeRef</span><span class="w"> </span><span class="n">destinationParent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">NodeRef</span><span class="p">)</span><span class="n">ruleAction</span><span class="p">.</span><span class="na">getParameterValue</span><span class="p">(</span><span class="n">PARAM_DESTINATION_FOLDER</span><span class="p">);</span>
<span class="w">    </span><span class="k">try</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">fileFolderService</span><span class="p">.</span><span class="na">move</span><span class="p">(</span><span class="n">actionedUponNodeRef</span><span class="p">,</span><span class="w"> </span><span class="n">destinationParent</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">FileNotFoundException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Do nothing</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>The code simply grabs the parameter value for the destination folder and
then calls the <code>FileFolderService</code> to do the move. This is a good start
for Move Replaced. All I need to do is modify the <code>executeImpl()</code> method to
find the nodes related to the current node by a "replaces" association,
and then for each result, set up and perform a move.</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">executeImpl</span><span class="p">(</span><span class="n">Action</span><span class="w"> </span><span class="n">ruleAction</span><span class="p">,</span><span class="w"> </span><span class="n">NodeRef</span><span class="w"> </span><span class="n">actionedUponNodeRef</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// get the replaces associations for this node</span>
<span class="w">    </span><span class="n">List</span><span class="o">&lt;</span><span class="n">AssociationRef</span><span class="o">&gt;</span><span class="w"> </span><span class="n">assocRefs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nodeService</span><span class="p">.</span><span class="na">getTargetAssocs</span><span class="p">(</span><span class="n">actionedUponNodeRef</span><span class="p">,</span><span class="w"> </span><span class="p">((</span><span class="n">QNamePattern</span><span class="p">)</span><span class="w"> </span><span class="n">QName</span><span class="p">.</span><span class="na">createQName</span><span class="p">(</span><span class="n">NamespaceService</span><span class="p">.</span><span class="na">CONTENT_MODEL_1_0_URI</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;replaces&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">);</span>

<span class="w">    </span><span class="c1">// if there are none, return</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">assocRefs</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">         </span><span class="c1">// no work to do, return</span>
<span class="w">         </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">NodeRef</span><span class="w"> </span><span class="n">destinationParent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">NodeRef</span><span class="p">)</span><span class="n">ruleAction</span><span class="p">.</span><span class="na">getParameterValue</span><span class="p">(</span><span class="n">PARAM_DESTINATION_FOLDER</span><span class="p">);</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">AssociationRef</span><span class="w"> </span><span class="n">assocNode</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">assocRefs</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// create a noderef for the replaces association</span>
<span class="w">            </span><span class="n">NodeRef</span><span class="w"> </span><span class="n">targetNodeRef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">assocNode</span><span class="p">.</span><span class="na">getTargetRef</span><span class="p">();</span>
<span class="w">            </span><span class="c1">// if the node exists</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="na">nodeService</span><span class="p">.</span><span class="na">exists</span><span class="p">(</span><span class="n">targetNodeRef</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">fileFolderService</span><span class="p">.</span><span class="na">move</span><span class="p">(</span><span class="n">targetNodeRef</span><span class="p">,</span><span class="w"> </span><span class="n">destinationParent</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">);</span>
<span class="w">                </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="n">FileNotFoundException</span><span class="w"> </span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="c1">// Do nothing</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="c1">// next assocNode</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="c1">// end if isEmpty</span>
<span class="p">}</span>
</code></pre></div>
<p>The only other change needed is to change the value of the constant NAME from
"move" to "move-replaced". (Throughout this document I'll only include relevant
pieces of these classes—check the source that accompanies this tutorial for code
that actually compiles).</p>
<h3 id="step-2-configure-the-action-in-spring">Step 2: Configure the action in Spring<a class="headerlink" href="#step-2-configure-the-action-in-spring" title="Permanent link">&para;</a></h3>
<p>In the content types tutorial, you learned that Spring bean configurations go in
the context file for the AMP. That file is called "service-context.xml" and it
resides in:</p>
<div class="highlight"><pre><span></span><code>$TUTORIAL_HOME/actions-tutorial-platform/src/main/resources/alfresco/module/actions-tutorial-platform/context
</code></pre></div>
<p>The file is created for you by the Alfresco Maven SDK. Initially, it contains
some <code>bean</code> elements for some demo classes that are also created by the Alfresco
Maven SDK. It is safe to delete the demo beans. If you deleted the demo Java
code that the SDK created, you must also delete the demo beans.</p>
<p>Add the following <code>bean</code> element to the existing <code>beans</code> element:</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;move-replaced&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;com.someco.action.executer.MoveReplacedActionExecuter&quot;</span><span class="w"> </span><span class="na">parent=</span><span class="s">&quot;action-executer&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;fileFolderService&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;ref</span><span class="w"> </span><span class="na">bean=</span><span class="s">&quot;FileFolderService&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/property&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;nodeService&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;ref</span><span class="w"> </span><span class="na">bean=</span><span class="s">&quot;NodeService&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</code></pre></div>
<p>That's all there is to it. You can now invoke either of these two actions with
the Action Service.</p>
<h3 id="testing-the-action">Testing the Action<a class="headerlink" href="#testing-the-action" title="Permanent link">&para;</a></h3>
<p>In the source code that accompanies this tutorial, I've included some
integration tests. The integration tests just attempt to use the <code>ActionService</code>
to get the action. For the Move Replaced action, I also execute the action.</p>
<p>If you are following along, you can copy the <code>MoveReplacedActionIT</code> class into:</p>
<div class="highlight"><pre><span></span><code>$TUTORIAL_HOME/actions-tutorial-platform/src/test/java/com/someco/action/test
</code></pre></div>
<p>Once you do that (or if you have simply checked out the tutorial source from
GitHub) you can then run <code>./run.sh build_start_it_supported</code> to start up the
Alfresco Docker containers with your extensions installed. Once everything is
up, run <code>./run.sh test</code> to compile and run the integration tests.</p>
<p>So at this point, you've got one new custom action, but it isn't configured in
the Alfresco Share user interface. Before doing that, let's look at another
Action Executer example, then we'll configure them both in the UI.</p>
<h2 id="implementing-the-set-web-flag-action">Implementing the Set Web Flag action<a class="headerlink" href="#implementing-the-set-web-flag-action" title="Permanent link">&para;</a></h2>
<p>This action will be used to set the flag on content which should be shown in the
SomeCo portal. Recall from the content types tutorial that the property that
controls whether or not content should show up in the portal is a boolean named
<code>sc:isActive</code> which is defined as part of an aspect named <code>sc:webable</code>. Also in
that aspect is a date property named <code>sc:published</code> that keeps track of when the
content was last published to the portal.</p>
<p>The Set Web Flag action, then, needs to set the <code>sc:isActive</code> flag. The value to
set it to (<code>true</code> or <code>false</code>) can be passed in as a parameter to the action.
When the flag is set to <code>true</code>, the action should set the <code>sc:published</code>
property with the current date.</p>
<p>This action could be called from a rule, but SomeCo intends to configure a UI
action in the user interface to allow end-users the ability to enable or disable
a piece of content for display on the portal with a single click.</p>
<p>Just like in the Move Replaced example, the steps are:</p>
<ol>
<li>Write the action executer class</li>
<li>Configure the action in Spring</li>
</ol>
<p>Then, the action will be ready to use.</p>
<h3 id="step-1-write-the-setwebflag-action-executer-class">Step 1: Write the SetWebFlag action executer class<a class="headerlink" href="#step-1-write-the-setwebflag-action-executer-class" title="Permanent link">&para;</a></h3>
<p>Like the <code>MoveReplacedAction</code>, this action class extends
<code>ActionExecuterAbstractBase</code>. The action takes a parameter that specifies
the value for the <code>sc:isActive</code> flag. Actions declare parameters by
overriding the <code>addParameterDefinitions()</code> method, like this:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Override</span>
<span class="kd">protected</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">addParameterDefinitions</span><span class="p">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">ParameterDefinition</span><span class="o">&gt;</span><span class="w"> </span><span class="n">paramList</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">paramList</span><span class="p">.</span><span class="na">add</span><span class="p">(</span>
<span class="w">        </span><span class="k">new</span><span class="w"> </span><span class="n">ParameterDefinitionImpl</span><span class="p">(</span>
<span class="w">                </span><span class="n">PARAM_ACTIVE</span><span class="p">,</span>
<span class="w">                </span><span class="n">DataTypeDefinition</span><span class="p">.</span><span class="na">BOOLEAN</span><span class="p">,</span>
<span class="w">                </span><span class="kc">false</span><span class="p">,</span>
<span class="w">                </span><span class="n">getParamDisplayLabel</span><span class="p">(</span><span class="n">PARAM_ACTIVE</span><span class="p">)));</span>
<span class="p">}</span>
</code></pre></div>
<p>The constructor for the <code>ParameterDefinitionImpl</code> takes the name of the
parameter, the parameter's data type, whether or not the parameter is
mandatory, and a label. If the custom action had additional parameters
this method would have one <code>paramList.add()</code> call for each parameter.</p>
<p>The next step is to create the action's logic in the <code>executeImpl()</code> method:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@Override</span>
<span class="kd">protected</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">executeImpl</span><span class="p">(</span><span class="n">Action</span><span class="w"> </span><span class="n">action</span><span class="p">,</span><span class="w"> </span><span class="n">NodeRef</span><span class="w"> </span><span class="n">actionedUponNodeRef</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">    </span>
<span class="w">    </span><span class="n">Boolean</span><span class="w"> </span><span class="n">activeFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">Boolean</span><span class="p">)</span><span class="n">action</span><span class="p">.</span><span class="na">getParameterValue</span><span class="p">(</span><span class="n">PARAM_ACTIVE</span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">activeFlag</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="n">activeFlag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span><span class="w"> </span><span class="c1">// default</span>

<span class="w">    </span><span class="c1">// set the sc:isActive property to true</span>
<span class="w">    </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">QName</span><span class="p">,</span><span class="w"> </span><span class="n">Serializable</span><span class="o">&gt;</span><span class="w"> </span><span class="n">properties</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nodeService</span><span class="p">.</span><span class="na">getProperties</span><span class="p">(</span><span class="n">actionedUponNodeRef</span><span class="p">);</span>
<span class="w">    </span><span class="n">properties</span><span class="p">.</span><span class="na">put</span><span class="p">(</span>
<span class="w">        </span><span class="n">QName</span><span class="p">.</span><span class="na">createQName</span><span class="p">(</span><span class="n">SomeCoModel</span><span class="p">.</span><span class="na">NAMESPACE_SOMECO_CONTENT_MODEL</span><span class="p">,</span><span class="w"> </span><span class="n">SomeCoModel</span><span class="p">.</span><span class="na">PROP_IS_ACTIVE</span><span class="p">),</span><span class="w"> </span><span class="n">activeFlag</span><span class="p">);</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">activeFlag</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// set the sc:published property to now</span>
<span class="w">        </span><span class="n">properties</span><span class="p">.</span><span class="na">put</span><span class="p">(</span>
<span class="w">            </span><span class="n">QName</span><span class="p">.</span><span class="na">createQName</span><span class="p">(</span><span class="n">SomeCoModel</span><span class="p">.</span><span class="na">NAMESPACE_SOMECO_CONTENT_MODEL</span><span class="p">,</span><span class="w"> </span><span class="n">SomeCoModel</span><span class="p">.</span><span class="na">PROP_PUBLISHED</span><span class="p">),</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Date</span><span class="p">());</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// if the aspect has already been added, set the properties</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">nodeService</span><span class="p">.</span><span class="na">hasAspect</span><span class="p">(</span><span class="n">actionedUponNodeRef</span><span class="p">,</span>
<span class="w">                </span><span class="n">QName</span><span class="p">.</span><span class="na">createQName</span><span class="p">(</span>
<span class="w">                    </span><span class="n">SomeCoModel</span><span class="p">.</span><span class="na">NAMESPACE_SOMECO_CONTENT_MODEL</span><span class="p">,</span>
<span class="w">                    </span><span class="n">SomeCoModel</span><span class="p">.</span><span class="na">ASPECT_SC_WEBABLE</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">nodeService</span><span class="p">.</span><span class="na">setProperties</span><span class="p">(</span><span class="n">actionedUponNodeRef</span><span class="p">,</span><span class="w"> </span><span class="n">properties</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// otherwise, add the aspect and set the properties</span>
<span class="w">        </span><span class="n">nodeService</span><span class="p">.</span><span class="na">addAspect</span><span class="p">(</span><span class="n">actionedUponNodeRef</span><span class="p">,</span>
<span class="w">                </span><span class="n">Qname</span><span class="p">.</span><span class="na">createQName</span><span class="p">(</span>
<span class="w">                    </span><span class="n">SomeCoModel</span><span class="p">.</span><span class="na">NAMESPACE_SOMECO_CONTENT_MODEL</span><span class="p">,</span>
<span class="w">                    </span><span class="n">SomeCoModel</span><span class="p">.</span><span class="na">ASPECT_SC_WEBABLE</span><span class="p">),</span><span class="w"> </span><span class="n">properties</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span><span class="w">                  </span>
<span class="p">}</span>
</code></pre></div>
<p>The logic should be pretty easy to follow. The code grabs the value of
the <code>active</code> parameter. Then, it sets up a <code>Map</code> to hold properties. If the
active flag is being set to <code>true</code>, the date property is added to the <code>Map</code>.
The last part of the method just checks to see whether the aspect needs
to be added or not. If so, the aspect can be added and the properties
set in a single call.</p>
<h3 id="step-2-configure-the-action-in-spring_1">Step 2: Configure the action in Spring<a class="headerlink" href="#step-2-configure-the-action-in-spring_1" title="Permanent link">&para;</a></h3>
<p>The Spring configuration for this action goes in the same context file
as the pervious action (service-context.xml):</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;set-web-flag&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;com.someco.action.executer.SetWebFlag&quot;</span><span class="w"> </span><span class="na">parent=</span><span class="s">&quot;action-executer&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;nodeService&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;ref</span><span class="w"> </span><span class="na">bean=</span><span class="s">&quot;NodeService&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</code></pre></div>
<p>The action can now be invoked by the Action Service. If you want, you can test
it by starting up the Docker containers and then running <code>./run.sh test</code> just
like you did for the Move Replaced action.</p>
<h2 id="localizing-the-actions">Localizing the actions<a class="headerlink" href="#localizing-the-actions" title="Permanent link">&para;</a></h2>
<p>This step isn't strictly necessary at this point, but it will save a step later.
There are some places in the Alfresco Share user interface that get localized
values from the repository tier. So a user-friendly title and description for
each of these actions needs to be set.</p>
<p>Following the same pattern as the content tutorial, I created a "messages"
folder in:</p>
<div class="highlight"><pre><span></span><code>$TUTORIAL_HOME/actions-tutorial-platform/src/main/resources/alfresco/module/actions-tutorial-platform
</code></pre></div>
<p>It is okay to delete the demo properties file that the SDK may have put in the
messages folder.</p>
<p>In that folder I created a file called "somecoactions.properties" with the
following content:</p>
<div class="highlight"><pre><span></span><code># Move Replaced action
move-replaced.title=Move replaced document to space
move-replaced.description=This will move the target node of a replaces association to a specified space.

# Set web flag action
set-web-flag.title=Sets the SC Web Flag
set-web-flag.description=This will add the sc:webable aspect and set the isActive flag.
</code></pre></div>
<p>Spring needs to know about this properties bundle, so I replaced the demo Spring
beans in bootstrap-context.xml with this bean:</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;${project.artifactId}_actionResourceBundles&quot;</span><span class="w"> </span><span class="na">parent=</span><span class="s">&quot;actionResourceBundles&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;resourceBundles&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;list&gt;</span>
<span class="w">            </span><span class="nt">&lt;value&gt;</span>alfresco.module.${project.artifactId}.messages.somecoactions<span class="nt">&lt;/value&gt;</span>
<span class="w">        </span><span class="nt">&lt;/list&gt;</span>
<span class="w">    </span><span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</code></pre></div>
<p>Now when Alfresco Share asks for the title or description of these actions, it
will get the appropriate values.</p>
<p>Both of these actions are now ready to be wired in to the user interface. That's
covered in Part 2.</p>
<h1 id="part-2-configuring-the-actions-front-end-in-share">Part 2: Configuring the Action's Front-End in Share<a class="headerlink" href="#part-2-configuring-the-actions-front-end-in-share" title="Permanent link">&para;</a></h1>
<p>In Part 1 of this document you learned how to create an Action Executer class.
The result was an action that could be called from code. But both actions need
to be invoked by end-users. In the case of the Move Replaced action, an end-user
will configure a rule that will invoke the action. When the end-user configures
the action while setting up the rule, they need to specify the directory to send
the replaced documents to. That means the user interface needs to know how to
let the end user pick a target folder.</p>
<p>The Set Web Flag action gives end-users the ability to set the active flag and
the publish date with a single click of a menu item. So the user interface needs
to know where to show that menu item and how to invoke the <code>set-web-flag</code> action
in the repository.</p>
<h2 id="configuring-the-replaceable-aspect-in-share">Configuring the Replaceable Aspect in Share<a class="headerlink" href="#configuring-the-replaceable-aspect-in-share" title="Permanent link">&para;</a></h2>
<p>Alfresco's out-of-the-box content model already defines an association called
<code>cm:replaces</code> as part of the <code>cm:replaceable</code> aspect. But neither the aspect nor
the association are configured to be displayed in the Share user interface.
That's easy to fix. All you have to do is edit share-config-custom.xml and then
localize the labels.</p>
<h3 id="step-1-edit-share-config-customxml">Step 1: Edit share-config-custom.xml<a class="headerlink" href="#step-1-edit-share-config-customxml" title="Permanent link">&para;</a></h3>
<p>Recall from the content types tutorial that the Share user interface
configuration resides in a file called “share-config-custom.xml”. The
actions-tutorial-share project will have its own share-config-custom.xml that
contains Share configuration specific to the custom actions. The file resides
under:</p>
<div class="highlight"><pre><span></span><code>$TUTORIAL_HOME/actions-tutorial-share/src/main/resources/META-INF
</code></pre></div>
<p>You can replace the demo config elements the SDK populated in
share-config-custom.xml as instructed in this section.</p>
<p>The <code>cm:replaceable</code> aspect can be added to the list of aspects a user can
see by adding some document library configuation to share-config-custom.xml,
like this:</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;alfresco-config&gt;</span>
<span class="w">    </span><span class="cm">&lt;!-- Document Library config section --&gt;</span>
<span class="w">    </span><span class="nt">&lt;config</span><span class="w"> </span><span class="na">evaluator=</span><span class="s">&quot;string-compare&quot;</span><span class="w"> </span><span class="na">condition=</span><span class="s">&quot;DocumentLibrary&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;aspects&gt;</span>
<span class="w">            </span><span class="cm">&lt;!-- Aspects that a user can see --&gt;</span>
<span class="w">            </span><span class="nt">&lt;visible&gt;</span>
<span class="w">                </span><span class="nt">&lt;aspect</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;cm:replaceable&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;/visible&gt;</span>

<span class="w">            </span><span class="cm">&lt;!-- Aspects that a user can add. Same as &quot;visible&quot; if left empty --&gt;</span>
<span class="w">            </span><span class="nt">&lt;addable&gt;</span>
<span class="w">            </span><span class="nt">&lt;/addable&gt;</span>

<span class="w">            </span><span class="cm">&lt;!-- Aspects that a user can remove. Same as &quot;visible&quot; if left empty --&gt;</span>
<span class="w">            </span><span class="nt">&lt;removeable&gt;</span>
<span class="w">            </span><span class="nt">&lt;/removeable&gt;</span>
<span class="w">        </span><span class="nt">&lt;/aspects&gt;</span>
<span class="w">    </span><span class="nt">&lt;/config&gt;</span>
<span class="nt">&lt;/alfresco-config&gt;</span>
</code></pre></div>
<p>Next, the <code>cm:replaces</code> association needs to show up when editing properties.
In this example, SomeCo will use instances of <code>cm:content</code> for policies, but
this would work the same way if a specific content type, like <code>sc:hrPolicy</code>,
were used instead. So I've copied the form configuration for <code>cm:content</code> from
the out-of-the-box form configuration into share-config-custom.xml.</p>
<p>Just like in the content types tutorial, the association is configured by
adding children to the <code>field-visibility</code> and <code>appearance</code> elements, like this:</p>
<div class="highlight"><pre><span></span><code><span class="w">   </span><span class="nt">&lt;show</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;surf:mid&quot;</span><span class="nt">/&gt;</span>
<span class="w">   </span><span class="nt">&lt;show</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;surf:label&quot;</span><span class="nt">/&gt;</span>

<span class="w">   </span><span class="cm">&lt;!-- cm:replaceable --&gt;</span>
<span class="w">   </span><span class="nt">&lt;show</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;cm:replaces&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>

<span class="nt">&lt;/field-visibility&gt;</span>
</code></pre></div>
<p>and this:</p>
<div class="highlight"><pre><span></span><code><span class="w">   </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;cm:sentdate&quot;</span><span class="w"> </span><span class="na">read-only=</span><span class="s">&quot;true&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">   </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;cm:subjectline&quot;</span><span class="w"> </span><span class="na">read-only=</span><span class="s">&quot;true&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">   </span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;cm:replaces&quot;</span><span class="w"> </span><span class="na">label-id=</span><span class="s">&quot;assoc.cm_replaces&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/appearance&gt;</span>
</code></pre></div>
<h3 id="step-2-localize-the-labels">Step 2: Localize the labels<a class="headerlink" href="#step-2-localize-the-labels" title="Permanent link">&para;</a></h3>
<p>The last step in exposing the <code>cm:replaceable</code> aspect and <code>cm:replaces</code>
association is localizing the labels. As you saw in the content types tutorial,
custom labels go in:</p>
<div class="highlight"><pre><span></span><code>$TUTORIAL_HOME/actions-tutorial-share/src/main/resources/alfresco/web-extension/messages
</code></pre></div>
<p>The SDK probably created a demo properties file in that directory. Delete it.</p>
<p>I'll create a new file for this module called scActions.properties. In it goes
the following:</p>
<div class="highlight"><pre><span></span><code>#cm:replaceable
aspect.cm_replaceable=Replaceable
assoc.cm_replaces=Replaces
</code></pre></div>
<p>The custom properties file needs to be configured using Spring. So, again, just
like the custom content types tutorial, I'll edit a context file called "actions-tutorial-slingshot-application-context.xml" in:</p>
<div class="highlight"><pre><span></span><code>$TUTORIAL_HOME/actions-tutorial-share/src/main/resources/alfresco/web-extension
</code></pre></div>
<p>Replace the demo bean that the SDK created for you with this:</p>
<div class="highlight"><pre><span></span><code><span class="cm">&lt;!-- Add Someco messages --&gt;</span>
<span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;${project.artifactId}_resources&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;org.springframework.extensions.surf.util.ResourceBundleBootstrapComponent&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;resourceBundles&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;list&gt;</span>
<span class="w">            </span><span class="nt">&lt;value&gt;</span>alfresco.web-extension.messages.scActions<span class="nt">&lt;/value&gt;</span>
<span class="w">        </span><span class="nt">&lt;/list&gt;</span>
<span class="w">    </span><span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</code></pre></div>
<p>Now the replaceable aspect can be added to and removed from documents using
Alfresco Share. The next step is to configure the Move Replaced Rule Action in
Share.</p>
<h2 id="configuring-the-move-replaced-rule-action-in-share">Configuring the Move Replaced Rule Action in Share<a class="headerlink" href="#configuring-the-move-replaced-rule-action-in-share" title="Permanent link">&para;</a></h2>
<p>Share is pretty smart. If you deploy the Move Replaced action as-is it will
automatically get added to the list of actions users can select when configuring
a rule. So for simple actions, you won't have to do anything further. But in
this example, the action takes an argument. By default, Share will try to render
a plain text field for the argument, like this:</p>
<p><img alt="By default, Share renders a plain text field for the action's parameter" src="../images/unconfigured-move-replaced-param.png" /></p>
<p>A plain text field for the parameter might work in some cases, but this action
takes a node reference as an argument and making an end-user provide a node
reference for the target folder would be a very bad thing. Instead, Share needs
to render a folder picker dialog for the target folder argument. Luckily,
Alfresco has already developed such a dialog—Share just has to be told to use
it.</p>
<p>Unfortunately, at the moment, getting a folder picker to show up for this action
takes a bit more work than it ought to. Here is what is involved:</p>
<ol>
<li>Override the rule config action web script to point to a custom
    client-side component and to set the order the action appears in the
    action list.</li>
<li>Override the rule details and rule edit web script to include a
    “script” reference in the “head” section of the page that points to
    the client-side JavaScript where the custom client-side component
    lives.</li>
<li>Write the custom client-side component.</li>
</ol>
<p>It looks like a pain, but once you figure it out it isn't too bad. And
it is a lot easier than it used to be if that makes you feel any better.
Let's go through the steps.</p>
<h3 id="step-1-specify-the-custom-client-side-component-and-set-the-action-order">Step 1: Specify the custom client-side component and set the action order<a class="headerlink" href="#step-1-specify-the-custom-client-side-component-and-set-the-action-order" title="Permanent link">&para;</a></h3>
<p>Rule config lives in the rule config web script. It is easy to override one or
more files that make up a web script. In this case, copy the
rule-config-action.get.config.xml file from:</p>
<div class="highlight"><pre><span></span><code>$TOMCAT_HOME/webapps/share/WEB-INF/classes/alfresco/site-webscripts/org/alfresco/components/rules/config
</code></pre></div>
<p>into your own project. For example, in the code that accompanies this
tutorial, I copied the file into:</p>
<div class="highlight"><pre><span></span><code>$TUTORIAL_HOME/actions-tutorial-share/src/main/resources/alfresco/web-extension/site-webscripts/org/alfresco/components/rules/config
</code></pre></div>
<p>The first change is to specify a custom client-side JavaScript
component:</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;rule-config</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;action&quot;</span><span class="nt">&gt;</span>
<span class="w">   </span><span class="nt">&lt;component&gt;</span>SomeCo.RuleConfigActionCustom<span class="nt">&lt;/component&gt;</span>
<span class="w">   </span><span class="nt">&lt;config-definitions</span><span class="w"> </span><span class="na">webscript=</span><span class="s">&quot;/api/actiondefinitions&quot;</span><span class="nt">&gt;</span>
</code></pre></div>
<p>This will be a new client-side JavaScript component that will get
created shortly.</p>
<p>Next, the action gets arranged in the list of actions. In this case, it
makes sense to see it in the list right after “Move” so a new <code>action</code> element
gets added accordingly:</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;menu&gt;</span>
<span class="w">    </span><span class="nt">&lt;group&gt;</span>
<span class="w">        </span><span class="nt">&lt;item</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;select&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/group&gt;</span>
<span class="w">    </span><span class="nt">&lt;group&gt;</span>
<span class="w">        </span><span class="nt">&lt;action</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;script&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/group&gt;</span>
<span class="w">    </span><span class="nt">&lt;group&gt;</span>
<span class="w">        </span><span class="nt">&lt;action</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;copy&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;action</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;move&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;action</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;move-replaced&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/group&gt;</span>
</code></pre></div>
<p>Finally, the <code>move-replaced</code> action gets bound with a client-side JavaScript
function called <code>MoveReplaced</code>:</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;action</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;copy&quot;</span><span class="nt">&gt;</span>Copy<span class="nt">&lt;/action&gt;</span>
<span class="nt">&lt;action</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;move&quot;</span><span class="nt">&gt;</span>Move<span class="nt">&lt;/action&gt;</span>
<span class="nt">&lt;action</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;move-replaced&quot;</span><span class="nt">&gt;</span>MoveReplaced<span class="nt">&lt;/action&gt;</span><span class="w">      </span>
<span class="nt">&lt;action</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;simple-workflow&quot;</span><span class="nt">&gt;</span>SimpleWorkflow<span class="nt">&lt;/action&gt;</span>
</code></pre></div>
<p>With this configuration in place, the custom Move Replaced action will show up
in the list of actions that can be performed as part of a rule.</p>
<h3 id="step-2-add-a-reference-to-the-custom-client-side-javascript-file-to-the-head">Step 2: Add a reference to the custom client-side JavaScript file to the head<a class="headerlink" href="#step-2-add-a-reference-to-the-custom-client-side-javascript-file-to-the-head" title="Permanent link">&para;</a></h3>
<p>The <code>move-replaced</code> action is going to be invoking some client-side JavaScript.
So a reference to the file that contains the JavaScript needs to be added to the
page so it can be loaded by the browser. The preferred way to point to a
client-side resource is by adding it to the Freemarker view as a dependency. To
do that, the rule-details.get.html.ftl and rule-edit.get.html.ftl files are
copied from:</p>
<div class="highlight"><pre><span></span><code>$TOMCAT_HOME/webapps/share/WEB-INF/classes/alfresco/site-webscripts/org/alfresco/components/rules
</code></pre></div>
<p>Into the tutorial project under:</p>
<div class="highlight"><pre><span></span><code>$TUTORIAL_HOME/actions-tutorial-share/src/main/resources/alfresco/web-extension/site-webscripts/org/alfresco/components/rules
</code></pre></div>
<p>In both files, the new <code>script</code> element is added to the end of the JavaScript
dependencies, like this:</p>
<div class="highlight"><pre><span></span><code>&lt;@markup id=&quot;js&quot;&gt;
    &lt;#-- JavaScript Dependencies --&gt;
    ...SNIP...
    &lt;!--Custom javascript file include for detail mode --&gt;
    &lt;@script type=&quot;text/javascript&quot; src=&quot;${url.context}/res/components/someco/rules/config/rule-config-action-custom.js&quot; group=&quot;rules_custom&quot;&gt;&lt;/@script&gt;
&lt;/@&gt;
</code></pre></div>
<p>Okay, at this point, the rule form will be looking for a custom client-side
JavaScript component called SomeCo.RuleConfigActionCustom, the action will show
up in the right place, and the page's <code>head</code> element will include a reference to
the custom client-side JavaScript file where the component will reside. It's
time to implement the client-side JavaScript.</p>
<h3 id="step-3-implement-the-custom-client-side-javascript-component">Step 3: Implement the custom client-side JavaScript component<a class="headerlink" href="#step-3-implement-the-custom-client-side-javascript-component" title="Permanent link">&para;</a></h3>
<p>The FreeMarker files have been modified to include a reference to a file
called rule-config-action-custom.js. This file will contain client-side
JavaScript. It goes in:</p>
<div class="highlight"><pre><span></span><code>$TUTORIAL_HOME/actions-tutorial-share/src/main/resources/META-INF/resources/components/someco/rules/config
</code></pre></div>
<p>Alfresco has their rule-related client-side JavaScript under
“components/rules/config” so I used the same folder structure, using "someco" to
keep my stuff separate from Alfresco's.</p>
<p>The first thing the rule-config-action-custom.js file does is declare a SomeCo
namespace. It is important that you namespace everything in Alfresco to avoid
collisions with Alfresco's code or other add-ons you might install.</p>
<div class="highlight"><pre><span></span><code><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="ow">typeof</span><span class="w"> </span><span class="nx">SomeCo</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;undefined&quot;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">!</span><span class="nx">SomeCo</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">   </span><span class="kd">var</span><span class="w"> </span><span class="nx">SomeCo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="p">}</span>
</code></pre></div>
<p>Next, comes the constructor for the component (I've left out some boring stuff,
check the <a href="https://github.com/jpotts/alfresco-developer-series/blob/master/actions/actions-tutorial/actions-tutorial-share/src/main/resources/META-INF/resources/components/someco/rules/config/rule-config-action-custom.js">source</a> for the full listing):</p>
<div class="highlight"><pre><span></span><code><span class="nx">SomeCo</span><span class="p">.</span><span class="nx">RuleConfigActionCustom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">htmlId</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">   </span><span class="nx">SomeCo</span><span class="p">.</span><span class="nx">RuleConfigActionCustom</span><span class="p">.</span><span class="nx">superclass</span><span class="p">.</span><span class="kr">constructor</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="nx">htmlId</span><span class="p">);</span>

<span class="w">   </span><span class="c1">// Re-register with our own name</span>
<span class="w">   </span><span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;SomeCo.RuleConfigActionCustom&quot;</span><span class="p">;</span>
<span class="w">   </span><span class="nx">Alfresco</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">ComponentManager</span><span class="p">.</span><span class="nx">reregister</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>

<span class="w">   </span><span class="c1">// Instance variables</span>
<span class="w">   </span><span class="k">this</span><span class="p">.</span><span class="nx">customisations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">YAHOO</span><span class="p">.</span><span class="nx">lang</span><span class="p">.</span><span class="nx">merge</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">customisations</span><span class="p">,</span><span class="w"> </span><span class="nx">SomeCo</span><span class="p">.</span><span class="nx">RuleConfigActionCustom</span><span class="p">.</span><span class="nx">superclass</span><span class="p">.</span><span class="nx">customisations</span><span class="p">);</span>
<span class="w">   </span><span class="k">this</span><span class="p">.</span><span class="nx">renderers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">YAHOO</span><span class="p">.</span><span class="nx">lang</span><span class="p">.</span><span class="nx">merge</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">renderers</span><span class="p">,</span><span class="w"> </span><span class="nx">SomeCo</span><span class="p">.</span><span class="nx">RuleConfigActionCustom</span><span class="p">.</span><span class="nx">superclass</span><span class="p">.</span><span class="nx">renderers</span><span class="p">);</span>

<span class="w">   </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div>
<p>What's going on here is that the constructor is calling its superclass
constructor, then it is registering itself with the Alfresco component manager.
The YUI merge calls provide a way to avoid re-typing a bunch of code that exists
in the parent class.</p>
<p>The final bit is where the extend actually happens, and the <code>MoveReplaced</code>
handler is defined:</p>
<div class="highlight"><pre><span></span><code><span class="nx">YAHOO</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">SomeCo</span><span class="p">.</span><span class="nx">RuleConfigActionCustom</span><span class="p">,</span><span class="w"> </span><span class="nx">Alfresco</span><span class="p">.</span><span class="nx">RuleConfigAction</span><span class="p">,</span>
<span class="p">{</span>

<span class="w">   </span><span class="cm">/**</span>
<span class="cm">    * CUSTOMISATIONS</span>
<span class="cm">    */</span>

<span class="w">   </span><span class="nx">customisations</span><span class="o">:</span>
<span class="w">   </span><span class="p">{</span><span class="w">         </span>
<span class="w">      </span><span class="nx">MoveReplaced</span><span class="o">:</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">         </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">configDef</span><span class="p">,</span><span class="w"> </span><span class="nx">ruleConfig</span><span class="p">,</span><span class="w"> </span><span class="nx">configEl</span><span class="p">)</span>
<span class="w">         </span><span class="p">{</span>
<span class="w">              </span><span class="c1">// Display as path</span>
<span class="w">              </span><span class="k">this</span><span class="p">.</span><span class="nx">_getParamDef</span><span class="p">(</span><span class="nx">configDef</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;destination-folder&quot;</span><span class="p">).</span><span class="nx">_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;path&quot;</span><span class="p">;</span>
<span class="w">              </span><span class="k">return</span><span class="w"> </span><span class="nx">configDef</span><span class="p">;</span>
<span class="w">         </span><span class="p">},</span>
<span class="w">         </span><span class="nx">edit</span><span class="o">:</span><span class="w"> </span><span class="kd">function</span><span class="p">(</span><span class="nx">configDef</span><span class="p">,</span><span class="w"> </span><span class="nx">ruleConfig</span><span class="p">,</span><span class="w"> </span><span class="nx">configEl</span><span class="p">)</span>
<span class="w">         </span><span class="p">{</span>
<span class="w">             </span><span class="c1">// Hide all parameters since we are using a cusotm ui but set default values</span>
<span class="w">             </span><span class="k">this</span><span class="p">.</span><span class="nx">_hideParameters</span><span class="p">(</span><span class="nx">configDef</span><span class="p">.</span><span class="nx">parameterDefinitions</span><span class="p">);</span>

<span class="w">             </span><span class="c1">// Make parameter renderer create a &quot;Destination&quot; button that displays an destination folder browser</span>
<span class="w">             </span><span class="nx">configDef</span><span class="p">.</span><span class="nx">parameterDefinitions</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="mf">0</span><span class="p">,{</span>
<span class="w">                </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;arca:destination-dialog-button&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="nx">displayLabel</span><span class="o">:</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">msg</span><span class="p">(</span><span class="s2">&quot;label.to&quot;</span><span class="p">),</span>
<span class="w">                </span><span class="nx">_buttonLabel</span><span class="o">:</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">msg</span><span class="p">(</span><span class="s2">&quot;button.select-folder&quot;</span><span class="p">),</span>
<span class="w">                </span><span class="nx">_destinationParam</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;destination-folder&quot;</span>
<span class="w">             </span><span class="p">});</span>
<span class="w">             </span><span class="k">return</span><span class="w"> </span><span class="nx">configDef</span><span class="p">;</span>
<span class="w">         </span><span class="p">}</span>
<span class="w">      </span><span class="p">},</span>
<span class="w">   </span><span class="p">},</span>

<span class="p">});</span>
</code></pre></div>
<p>This part is a copy of the out-of-the-box handler for <code>Move</code> with the
object renamed to <code>MoveReplaced</code>. The <code>MoveReplaced</code> object has two methods:
<code>text</code> and <code>edit</code>. The <code>text</code> method returns what is displayed for the component
in read mode. Edit is for edit mode. The <code>edit</code> method is what is responsible
for generating the button that invokes the folder picker. In this case, <code>edit</code>
leverages an existing renderer called <code>arca:destination-dialog-button</code> that is
defined in the superclass. If you needed to produce markup for a parameter for
which Alfresco doesn't already have a renderer, you would add the appropriate
code to the renderers object.</p>
<p>With this final step in place, end-users can configure a rule that invokes the
Move Replaced action. The rule editor will use the custom handler for the action
so that a folder picker dialog is used to select the target folder.</p>
<p>You can see this happening in the screenshot below. You can see the dialog that
gets launched when the Select button is clicked as well as the little folder
icon and folder path that are rendered once a selection is made.</p>
<p><img alt="Configuring the Move Replaced action in Share" src="../images/move-replaced-config-share.png" /></p>
<h3 id="testing-your-share-configuration">Testing Your Share Configuration<a class="headerlink" href="#testing-your-share-configuration" title="Permanent link">&para;</a></h3>
<p>You can use the Alfresco Maven SDK to run the actions-tutorial project using
Docker and Docker Compose. The Alfresco and Share WARs installed in the Tomcat
servers in the Docker containers will have the content-tutorial AMPs installed
because we added them to the Docker modules' pom.xml and, of course, will also
have the actions-tutorial AMPs installed.</p>
<p>To start it up, open a terminal window, switch to the actions-tutorial project
root directory, and run <code>./run.sh build_start</code> (if you are on Windows, use
<code>run.bat</code> instead).</p>
<p>That starts Alfresco in a container that is listening on port 8080 and Share in
a container that is listening on port 8180.</p>
<h2 id="configuring-the-set-web-flag-ui-action-in-share">Configuring the Set Web Flag UI Action in Share<a class="headerlink" href="#configuring-the-set-web-flag-ui-action-in-share" title="Permanent link">&para;</a></h2>
<p>Now it is time to shift focus from rule actions to UI actions. SomeCo
wants end-users to be able to click an item in the menu that either
enables or disables the web flag. Alfresco has a framework that allows
you to easily add new UI actions to the menu. You can configure:</p>
<ul>
<li>UI actions that call a web page (external or within Share),</li>
<li>UI actions that invoke rule actions on the repository tier that take
    no parameters,</li>
<li>UI actions that invoke rule actions on the repository tier that
    launch a dialog to gather parameters before passing those parameters
    to an action on the repository tier,</li>
<li>UI actions that call arbitrary client-side JavaScript action
    handlers.</li>
</ul>
<p>Recall that the Set Web Flag action you wrote in Part 1 takes one parameter—the
value of the <code>active</code> flag. I could use the action framework out-of-the-box to
invoke a dialog that lets the user set the action flag to <code>true</code> or <code>false</code> and
then call the set web flag action. But that doesn't meet the single-click
requirement, and a form is overkill to grab one boolean value.</p>
<p>If you look in the list above, you'll see there isn't an option to
hardcode arbitrary parameters in the action config when the action is
called. So we're forced to either call a custom client-side JavaScript
action handler or add new actions to the repository tier that don't take
parameters. There's no “right” answer here—it's just a matter of where
you want to write the code. At some point, Alfresco will probably
enhance the framework to meet this use case. Until then, for this
example, I'm going to go the “no parameter” route, which means I'll have
to add two new actions on the repository tier that don't require
parameters to be passed in.</p>
<p>So, the steps to follow for this example are:</p>
<ol>
<li>Create two new repository tier actions that take no parameters</li>
<li>Update share-config-custom.xml with the action configuration</li>
<li>Create icons and localize the strings</li>
</ol>
<h3 id="step-1-create-two-new-repository-tier-actions">Step 1: Create two new repository tier actions<a class="headerlink" href="#step-1-create-two-new-repository-tier-actions" title="Permanent link">&para;</a></h3>
<p>You created action executer classes in Part 1 of this tutorial so this
is nothing new. We're creating two new ones that don't take any parameters
because we want to easily take advantage of the logic Alfresco Share already has
for invoking actions that don't take parameters. There needs to be one action
for enabling the active flag and one for disabling it and neither should take a
parameter. By sub-classing the existing <code>SetWebFlag</code> action, code can be kept to
a minimum. Here's the <code>EnableWebFlag</code> action executer in its entirety:</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">EnableWebFlag</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">SetWebFlag</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">protected</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">executeImpl</span><span class="p">(</span><span class="n">Action</span><span class="w"> </span><span class="n">action</span><span class="p">,</span><span class="w"> </span><span class="n">NodeRef</span><span class="w"> </span><span class="n">actionedUponNodeRef</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">action</span><span class="p">.</span><span class="na">setParameterValue</span><span class="p">(</span><span class="n">SetWebFlag</span><span class="p">.</span><span class="na">PARAM_ACTIVE</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">);</span>
<span class="w">        </span><span class="kd">super</span><span class="p">.</span><span class="na">executeImpl</span><span class="p">(</span><span class="n">action</span><span class="p">,</span><span class="w"> </span><span class="n">actionedUponNodeRef</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>The <code>DisableWebFlag</code> action looks just like this but sets the <code>active</code> flag
to <code>false</code>. I won't repeat it here.</p>
<p>The Spring configuration for the action is similarly short. It goes in
service-context.xml:</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;enable-web-flag&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;com.someco.action.executer.EnableWebFlag&quot;</span><span class="w"> </span><span class="na">parent=</span><span class="s">&quot;set-web-flag&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;publicAction&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;value&gt;</span>false<span class="nt">&lt;/value&gt;</span>
<span class="w">    </span><span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</code></pre></div>
<p>Again, I'm leaving out the <code>disable-web-flag</code> bean but it looks just like
this one with a different class. Setting the <code>publicAction</code> property to
false hides these actions from the action dropdowns. There's no real
reason to do that, in this case—it's just an example.</p>
<h3 id="step-2-update-share-config-customxml-with-the-action-configuration">Step 2: Update share-config-custom.xml with the action configuration<a class="headerlink" href="#step-2-update-share-config-customxml-with-the-action-configuration" title="Permanent link">&para;</a></h3>
<p>The next step is to configure the Share user interface to show the UI
actions in the document library and document details menus. While we're
at it, I'm going to also drop in a UI action that calls a web page just
for kicks.</p>
<p>The action config is in share-config-custom.xml. Action configuration consists
of two parts. The <code>actions</code> element contains a list of action definitions. The
<code>actionGroups</code> element contains a list of action groups. Action groups are
things like the list of actions shown in the document library document list or
the document details page.</p>
<p>Actions and action groups live in the <code>DocLibActions</code> config within
share-config-custom.xml. Here are the action definitions for the web
site action and web enable:</p>
<div class="highlight"><pre><span></span><code><span class="cm">&lt;!-- Actions --&gt;</span>
<span class="nt">&lt;config</span><span class="w"> </span><span class="na">evaluator=</span><span class="s">&quot;string-compare&quot;</span><span class="w"> </span><span class="na">condition=</span><span class="s">&quot;DocLibActions&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;actions&gt;</span>
<span class="w">        </span><span class="nt">&lt;action</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;someco-web-site&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;link&quot;</span><span class="w"> </span><span class="na">label=</span><span class="s">&quot;actions.someco.web-site&quot;</span><span class="w"> </span><span class="na">icon=</span><span class="s">&quot;someco-website&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;param</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;href&quot;</span><span class="nt">&gt;</span>https://ecmarchitect.com<span class="nt">&lt;/param&gt;</span>
<span class="w">            </span><span class="nt">&lt;param</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;target&quot;</span><span class="nt">&gt;</span>_blank<span class="nt">&lt;/param&gt;</span>
<span class="w">        </span><span class="nt">&lt;/action&gt;</span>
<span class="w">        </span><span class="nt">&lt;action</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;someco-web-enable&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;javascript&quot;</span><span class="w"> </span><span class="na">label=</span><span class="s">&quot;actions.someco.web-enable&quot;</span><span class="w"> </span><span class="na">icon=</span><span class="s">&quot;someco-create-website&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;param</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;function&quot;</span><span class="nt">&gt;</span>onActionSimpleRepoAction<span class="nt">&lt;/param&gt;</span>
<span class="w">            </span><span class="nt">&lt;permissions&gt;</span>
<span class="w">                </span><span class="nt">&lt;permission</span><span class="w"> </span><span class="na">allow=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;</span>Write<span class="nt">&lt;/permission&gt;</span>
<span class="w">            </span><span class="nt">&lt;/permissions&gt;</span>
<span class="w">            </span><span class="nt">&lt;param</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;action&quot;</span><span class="nt">&gt;</span>enable-web-flag<span class="nt">&lt;/param&gt;</span>
<span class="w">            </span><span class="nt">&lt;param</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;successMessage&quot;</span><span class="nt">&gt;</span>message.web-flag.enabled<span class="nt">&lt;/param&gt;</span>
<span class="w">            </span><span class="nt">&lt;param</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;failureMessage&quot;</span><span class="nt">&gt;</span>message.web-flag.failure<span class="nt">&lt;/param&gt;</span>
<span class="w">        </span><span class="nt">&lt;/action&gt;</span>
</code></pre></div>
<p>The <code>someco-web-site</code> action is really simple. It is a <code>link</code> type of an
action, which means it is invoking a URL that is provided in a
parameter. The labels and icons will get set up in the next step.</p>
<p>The <code>someco-web-enable</code> action is a little more involved. It is a
“javascript” action, which means it is calling a client-side JavaScript
handler. What's cool is that Alfresco has already provided a client-side
handler called “onSimpleRepoAction”. It just needs to know the name of
the repository tier action to invoke (the ones created in Step 1) and
messages to display on success and failure.</p>
<p>I've left out <code>someco-web-disable</code> because it is so similar.</p>
<p>This action uses the built-in <code>onActionSimpleRepoAction</code>, but what if you
needed to gather parameters from the end-user before calling the action?
For that you can use <code>onActionFormDialog</code>. The <code>itemId</code> specifies a form ID
corresponding to a form defined in share-config-custom.xml. Take a
look at the out-of-the-box <code>document-transform</code> action as an example.</p>
<p>The last part of the config is the action definitions. This slots the
actions into the appropriate groups:</p>
<div class="highlight"><pre><span></span><code><span class="w">    </span><span class="nt">&lt;actionGroups&gt;</span>
<span class="w">        </span><span class="nt">&lt;actionGroup</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;document-browse&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;action</span><span class="w"> </span><span class="na">index=</span><span class="s">&quot;500&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;someco-web-site&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;action</span><span class="w"> </span><span class="na">index=</span><span class="s">&quot;510&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;someco-web-enable&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;action</span><span class="w"> </span><span class="na">index=</span><span class="s">&quot;520&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;someco-web-disable&quot;</span><span class="w"> </span><span class="nt">/&gt;</span><span class="w">                </span>
<span class="w">        </span><span class="nt">&lt;/actionGroup&gt;</span>
<span class="w">        </span><span class="nt">&lt;actionGroup</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;document-details&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;action</span><span class="w"> </span><span class="na">index=</span><span class="s">&quot;500&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;someco-web-site&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;action</span><span class="w"> </span><span class="na">index=</span><span class="s">&quot;510&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;someco-web-enable&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;action</span><span class="w"> </span><span class="na">index=</span><span class="s">&quot;520&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;someco-web-disable&quot;</span><span class="w"> </span><span class="nt">/&gt;</span><span class="w">                </span>
<span class="w">        </span><span class="nt">&lt;/actionGroup&gt;</span>
<span class="w">    </span><span class="nt">&lt;/actionGroups&gt;</span>
<span class="nt">&lt;/config&gt;</span>
</code></pre></div>
<p>There are a couple of things to note about the action configuration.
First, you don't have to copy in the out-of-the-box actions and action
groups. They will get merged in. Second, the order of the action items
in the list can be controlled by setting the index attribute. The higher
the index, the lower in the list the menu items appear.</p>
<h3 id="step-3-create-icons-and-localize-the-strings">Step 3: Create icons and localize the strings<a class="headerlink" href="#step-3-create-icons-and-localize-the-strings" title="Permanent link">&para;</a></h3>
<p>The last step is to provide some icons for the actions and localize the
action labels. In step 2 the action element had an “icon” attribute.
Alfresco will look in a path for an icon that starts with that name and
ends with “-16.png”. Entirely lacking in graphics skills, I grabbed a
couple of out-of-the-box icons that looked somewhat applicable and
copied them in to my project under:</p>
<div class="highlight"><pre><span></span><code>$TUTORIAL_HOME/actions-tutorial-share/src/main/resources/META-INF/resources/components/documentlibrary/actions
</code></pre></div>
<p>Because this is Alfresco's folder structure, I made sure to name the icons
starting with “someco” so they would not be confused with others.</p>
<p>The localized strings can go in the existing scActions.properties file.
Here they are:</p>
<div class="highlight"><pre><span></span><code>#actions
actions.someco.web-site=SomeCo
actions.someco.web-enable=SC Enable Web
actions.someco.web-disable=SC Disable Web
message.web-flag.enabled=Successfully enabled the SomeCo active flag
message.web-flag.disabled=Successfully disabled the SomeCo active flag
message.web-flag.failure=Error setting the SomeCo active flag
</code></pre></div>
<p>With icons and localized strings in place, you can deploy and run and
everything should work. If your server is still running from earlier, do a
<code>./run.sh stop</code> to stop it, then launch it again by running <code>./run.sh build_start</code>
(or <code>run.bat</code> for Windows).</p>
<p>If you don't know whether or not your containers are still running, do a
<code>docker ps</code> to list the running containers.</p>
<p>Once you are able to log in to Share you'll notice that both the Enable and
Disable UI actions show up at the same time, which is lame. Check it out:</p>
<p><img alt="Yuck, SC Enable and SC Disable show up simultaneously" src="../images/enable-disable-same-time.png" /></p>
<p>The enable should only show up when the active flag is not set to <code>true</code>. The
disable should only show up when the active flag is set to <code>true</code>. That's easy
to fix with an evaluator and that's covered in the next section.</p>
<h2 id="finishing-touches-evaluators-indicators">Finishing Touches: Evaluators &amp; Indicators<a class="headerlink" href="#finishing-touches-evaluators-indicators" title="Permanent link">&para;</a></h2>
<p>If you are writing a UI action that should show up all of the time, you
don't need to do anything else. But hiding a UI action based on certain
conditions is a pretty common requirement. In this example, the UI
action needs to hide based on a metadata value. Alfresco has several
“evaluators” that can be leveraged out-of-the-box to do this. You can
hide UI actions based on things like:</p>
<ul>
<li>The presence of an aspect</li>
<li>The type of a node</li>
<li>Mimetype</li>
<li>The type of site the document library is sitting in</li>
<li>The name of the site</li>
</ul>
<p>Evaluators can also be chained together if multiple conditions need to
apply. The out-of-the-box evaluators live in
slingshot-documentlibrary-context.xml so refer to that file for the
full list of evaluators and an example of how chaining works. You can
also write completely new evaluators using Java deployed to the Share
tier.</p>
<p>For this example, the out-of-the-box “value” evaluator will do quite
nicely. The steps, then, will be as follows:</p>
<ol>
<li>Declare a new evaluator in Spring config that extends the “value”
    evaluator</li>
<li>Update the action config in share-config-custom.xml to point to the
    evaluator</li>
</ol>
<p>Alfresco has also made it easy to configure “indicators”, which are
little icons in the document library column. This isn't entirely
relevant to the subject at hand, but because they work just like
evaluators and because it makes it easy to see from the document library
which content has the active flag set, I'm going to add a third step:</p>
<ol>
<li>Update the share-config-custom.xml file to show a document library
    indicator</li>
</ol>
<p>After these steps are complete, the UI actions will show or hide
themselves appropriately and end-users will be able to see documents
with the <code>sc:isActive</code> flag set to <code>true</code> from the document list.</p>
<h3 id="step-1-declare-a-new-evaluator-in-spring-config">Step 1: Declare a new evaluator in Spring config<a class="headerlink" href="#step-1-declare-a-new-evaluator-in-spring-config" title="Permanent link">&para;</a></h3>
<p>Only one evaluator is needed for this example. The evaluator just needs
to know the value of the <code>sc:isActive</code> flag—the UI actions can show or hide
themselves based on that. Evaluators live in Spring config. This project already
has “actions-tutorial-share-slingshot-application-context.xml” so I added the
evaluator to that file:</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;someco.evaluator.doclib.action.isActive&quot;</span><span class="w"> </span><span class="na">parent=</span><span class="s">&quot;evaluator.doclib.action.value&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;accessor&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;node.properties.sc:isActive&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;comparator&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;org.alfresco.web.evaluator.StringEqualsComparator&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;value&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;true&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;/bean&gt;</span>
<span class="w">    </span><span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</code></pre></div>
<p>This bean extends the out-of-the-box “value” evaluator and provides
properties specific to our needs. In this case, the <code>accessor</code> is the
name of the property the evaluator needs to inspect. The comparator does
a string comparison against the value of “true”. Note the use of
“someco” in the bean ID. This is another place where you want to make
sure you are using your own namespace.</p>
<p>All evaluators work similarly. If you wanted to check for a specific
aspect, for example, you would extend the aspect evaluator and then
specify the aspect you are looking for in one of the properties.</p>
<h3 id="step-2-update-the-action-config-in-share-config-customxml">Step 2: Update the action config in share-config-custom.xml<a class="headerlink" href="#step-2-update-the-action-config-in-share-config-customxml" title="Permanent link">&para;</a></h3>
<p>With an evaluator declared the next step is to tell the action
configuration which evaluator to use to decide whether or not to show
the UI action. So, back over in share-config-custom.xml, I've added two new
<code>evaluator</code> elements to the existing <code>action</code> elements. The <code>evaluator</code> elements
point to the <code>someco.evaluator.doclib.action.isActive</code> evaluator configured in
the previous step:</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;action</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;someco-web-enable&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;javascript&quot;</span><span class="w"> </span><span class="na">label=</span><span class="s">&quot;actions.someco.web-enable&quot;</span><span class="w"> </span><span class="na">icon=</span><span class="s">&quot;someco-create-website&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;param</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;function&quot;</span><span class="nt">&gt;</span>onActionSimpleRepoAction<span class="nt">&lt;/param&gt;</span>
<span class="w">    </span><span class="nt">&lt;permissions&gt;</span>
<span class="w">        </span><span class="nt">&lt;permission</span><span class="w"> </span><span class="na">allow=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;</span>Write<span class="nt">&lt;/permission&gt;</span>
<span class="w">    </span><span class="nt">&lt;/permissions&gt;</span>
<span class="w">    </span><span class="nt">&lt;param</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;action&quot;</span><span class="nt">&gt;</span>enable-web-flag<span class="nt">&lt;/param&gt;</span>
<span class="w">    </span><span class="nt">&lt;param</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;successMessage&quot;</span><span class="nt">&gt;</span>message.web-flag.enabled<span class="nt">&lt;/param&gt;</span>
<span class="w">    </span><span class="nt">&lt;param</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;failureMessage&quot;</span><span class="nt">&gt;</span>message.web-flag.failure<span class="nt">&lt;/param&gt;</span>
<span class="w">    </span><span class="nt">&lt;evaluator</span><span class="w"> </span><span class="na">negate=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;</span>someco.evaluator.doclib.action.isActive<span class="nt">&lt;/evaluator&gt;</span>
<span class="nt">&lt;/action&gt;</span>
<span class="nt">&lt;action</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;someco-web-disable&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;javascript&quot;</span><span class="w"> </span><span class="na">label=</span><span class="s">&quot;actions.someco.web-disable&quot;</span><span class="w"> </span><span class="na">icon=</span><span class="s">&quot;someco-delete-website&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;param</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;function&quot;</span><span class="nt">&gt;</span>onActionSimpleRepoAction<span class="nt">&lt;/param&gt;</span>
<span class="w">    </span><span class="nt">&lt;permissions&gt;</span>
<span class="w">        </span><span class="nt">&lt;permission</span><span class="w"> </span><span class="na">allow=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;</span>Write<span class="nt">&lt;/permission&gt;</span>
<span class="w">    </span><span class="nt">&lt;/permissions&gt;</span>
<span class="w">    </span><span class="nt">&lt;param</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;action&quot;</span><span class="nt">&gt;</span>disable-web-flag<span class="nt">&lt;/param&gt;</span>
<span class="w">    </span><span class="nt">&lt;param</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;successMessage&quot;</span><span class="nt">&gt;</span>message.web-flag.disabled<span class="nt">&lt;/param&gt;</span>
<span class="w">    </span><span class="nt">&lt;param</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;failureMessage&quot;</span><span class="nt">&gt;</span>message.web-flag.failure<span class="nt">&lt;/param&gt;</span>
<span class="w">    </span><span class="nt">&lt;evaluator&gt;</span>someco.evaluator.doclib.action.isActive<span class="nt">&lt;/evaluator&gt;</span>
<span class="nt">&lt;/action&gt;</span>
</code></pre></div>
<p>Both actions use the same evaluator. For the <code>someco-web-enable</code> action,
the evaluator is negated. So if the evaluator returns true (i.e., the
<code>sc:isActive</code> property is set to <code>true</code>) the web enable action will be
hidden. If the evaluator returns <code>false</code>, the action will show itself.</p>
<h3 id="step-3-update-the-share-config-customxml-file-to-show-a-document-library-indicator">Step 3: Update the share-config-custom.xml file to show a document library indicator<a class="headerlink" href="#step-3-update-the-share-config-customxml-file-to-show-a-document-library-indicator" title="Permanent link">&para;</a></h3>
<p>The last step is really not needed at all if all you are doing is adding
an action to the menu. But because it is easy to do and leverages the
same evaluator written in the previous step, I didn't think you'd mind.</p>
<p>The goal here is to show a little icon in the document library only if
the <code>sc:isActive</code> property is set to <code>true</code>. If you are already thinking,
“Hey, that sounds like an evaluator!” you've got it.</p>
<p>Indicators are part of the “DocumentLibrary” config in
share-config-custom.xml. All it needs is a pointer to an evaluator. In
this case, the one created earlier can be reused:</p>
<div class="highlight"><pre><span></span><code><span class="w">    </span><span class="nt">&lt;/types&gt;</span>

<span class="w">    </span><span class="cm">&lt;!-- Custom Indicators --&gt;</span>
<span class="w">    </span><span class="nt">&lt;indicators&gt;</span>
<span class="w">        </span><span class="nt">&lt;indicator</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;someco-website&quot;</span><span class="w"> </span><span class="na">index=</span><span class="s">&quot;10&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;evaluator&gt;</span>someco.evaluator.doclib.action.isActive<span class="nt">&lt;/evaluator&gt;</span>
<span class="w">        </span><span class="nt">&lt;/indicator&gt;</span>
<span class="w">    </span><span class="nt">&lt;/indicators&gt;</span>
<span class="nt">&lt;/config&gt;</span>
</code></pre></div>
<p>Alfresco will use the indicator's id attribute appended with “-16.png”
for the icon. I copied the same icon used for the “enable” action into:</p>
<div class="highlight"><pre><span></span><code>$TUTORIAL_HOME/actions-tutorial-share/src/main/resources/META-INF/resources/components/documentlibrary/indicators
</code></pre></div>
<p>for this purpose.</p>
<p>Now you have seen that evaluators can be used to show UI actions and indicators.
If the evaluator returns <code>true</code> the UI action or indicator is shown. If it
returns <code>false</code> the UI action or indicator is hidden. In the UI actions, you saw
that the <code>negate</code> attribute can be used to invert what the evaluator returns.
That was used to hide the <code>someco-web-enable</code> UI action when the <code>isActive</code> flag
was already <code>true</code>.</p>
<p>That's it. You can now either do a <code>./run.sh stop</code> followed by a <code>./run.sh build_start</code>
to stop and start all of the containers or you can do a <code>mvn install -DskipTests</code>
to build the AMPs then do a <code>./run.sh reload_share</code> to just restart the Share
container. You may find the second option to be a lot faster.</p>
<h1 id="deploying-to-a-real-server">Deploying to a Real Server<a class="headerlink" href="#deploying-to-a-real-server" title="Permanent link">&para;</a></h1>
<p>So far, you've been running everything using SDK-generated Docker containers
and that works really well while you are developing.</p>
<p>If you want to deploy to a standalone Alfresco server, you can either manually
copy the AMP files to the "amps" and "amps_share" directories, then run the MMT
(Module Management Tool) to install the AMPs into your WAR files or you can use
the <a href="https://github.com/Alfresco/acs-community-packaging">ACS Community Packaging</a>
project to create your own Docker images, then start those images up using
Docker Compose, or Kubernetes, depending on how your servers are deployed.</p>
<p>Regardless of the method you choose, you'll need to deploy a total of four AMPs
(two repository tier AMPs and two Share tier AMPs) for this to work because the
action tutorial AMPs depend on the content tutorial AMPs.</p>
<p>If everything is working correctly, you should see the SomeCo web site
link and either the SC Web Enable or the SC Web Disable menu items from
both the browse menu and the details page as shown below.</p>
<p><img alt="Indicators show which content has the active flag set in Share" src="../images/indicators-browse-share.png" /></p>
<p><img alt="Custom UI actions in the document details page" src="../images/ui-actions-disable-details-share.png" /></p>
<p><img alt="Custom UI actions in the document list" src="../images/ui-actions-disable-browse-share.png" /></p>
<p>Clicking the “SomeCo” menu item will open a browser window to the URL
specified in the configuration. Clicking the “SC Disable Web” should
invoke the action on the repository tier and then refresh the metadata
and the action list.</p>
<h1 id="topics-to-explore-on-your-own">Topics to Explore On Your Own<a class="headerlink" href="#topics-to-explore-on-your-own" title="Permanent link">&para;</a></h1>
<p>This tutorial has shown how actions can be used to implement reusable
operations that can be run against content in the repository. Those
actions can be called from code using the Action Service and they can be
invoked from the user interface by configuring rules or by setting up UI
actions and placing those alongside other menu items in places like the
document list and the details page. Hopefully it has sparked some ideas
about how you could use custom actions in your next Alfresco implementation.</p>
<p>There are a few topics I did not have room to address here that you may want to
dig into on your own:</p>
<ul>
<li>Actions can be scheduled. For example, you might have an action that sends an
email summary of all the documents that have changed in a given folder in a day.</li>
<li>Rule actions can be configured to run a specific server-side JavaScript file
if they are running in the background and error out. This might be useful if
your action fails and leaves your content in a partial state.</li>
<li>In the rule configuration part, I am using an older style of extending the
out-of-the-box rule configuration component. The alternative is to use an
Alfresco Share Module to override the rule configuration web script instead of
overriding it directly.</li>
<li>You can use your own forms to gather data needed to pass along to an action.</li>
<li>There are many out-of-the-box evaluators you can use to show or hide UI
actions. You can also develop your own with Java.</li>
</ul>
<h1 id="where-to-find-more-information">Where to Find More Information<a class="headerlink" href="#where-to-find-more-information" title="Permanent link">&para;</a></h1>
<ul>
<li>The complete source code for these examples is available on <a href="https://github.com/jpotts/alfresco-developer-series">GitHub</a>.</li>
<li>Official documentation for both Enterprise Edition and Community Edition is
available at <a href="http://docs.alfresco.com/">docs.alfresco.com</a>.</li>
<li>Check the <a href="https://community.alfresco.com">Alfresco Community</a> site for blog
posts from Mike Hatfield and David Draper, two Alfresco engineers that write
about customizing Share.</li>
<li>If you are ready to cover new ground, try another <a href="https://ecmarchitect.com">ecmarchitect.com</a>
tutorial in the <a href="https://ecmarchitect.com/alfresco-developer-series">Alfresco Developer Series</a>.
The most logical next step is the <a href="https://ecmarchitect.com/alfresco-developer-series-tutorials/behaviors/tutorial/tutorial.html">Implementing Custom Behaviors</a>
tutorial.</li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.instant", "navigation.sections", "navigation.top", "content.code.copy"], "search": "../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>