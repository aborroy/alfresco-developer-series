
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Tutorials and best practices for Alfresco developers">
      
      
      
      
        <link rel="prev" href="../../../behaviors/tutorial/tutorial/">
      
      
        <link rel="next" href="../../../workflow/tutorial/tutorial/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.20">
    
    
      
        <title>WebScripts - Alfresco Developer Series</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.e53b48f4.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#introduction-to-the-web-script-framework" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Alfresco Developer Series" class="md-header__button md-logo" aria-label="Alfresco Developer Series" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Alfresco Developer Series
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              WebScripts
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/aborroy/alfresco-developer-series" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Alfresco Developer Series" class="md-nav__button md-logo" aria-label="Alfresco Developer Series" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Alfresco Developer Series
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/aborroy/alfresco-developer-series" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Tutorials
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../maven-sdk/tutorial/tutorial/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Maven SDK
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../content/tutorial/tutorial/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Content Types & CMIS
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../actions/tutorial/tutorial/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Actions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../behaviors/tutorial/tutorial/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Behaviors
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    WebScripts
    
  </span>
  

      </a>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../workflow/tutorial/tutorial/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Workflows
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="introduction-to-the-web-script-framework">Introduction to the Web Script Framework<a class="headerlink" href="#introduction-to-the-web-script-framework" title="Permanent link">&para;</a></h1>
<p><em>Jeff Potts, <a href="https://www.metaversant.com">Metaversant Group</a> — July, 2021</em></p>
<h1 id="license">License<a class="headerlink" href="#license" title="Permanent link">&para;</a></h1>
<p><img alt="" src="../images/cc-by-sa-88x31.png" /></p>
<p>This work is licensed under the Creative Commons Attribution-ShareAlike 3.0
Unported License. To view a copy of this license, visit http://creativecommons.org/licenses/by-sa/3.0/
or send a letter to Creative Commons, 444 Castro Street, Suite 900, Mountain
View, California, 94041, USA.</p>
<h1 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">&para;</a></h1>
<p>This tutorial is an introduction to the Alfresco Web Script Framework. It
continues the “SomeCo Whitepapers” example started in previous tutorials. Here's
what you have seen in the previous tutorials:</p>
<ul>
<li>The custom content types tutorial extended the out-of-the-box content model so
that SomeCo could store custom metadata about one of their document types,
whitepapers.</li>
<li>The custom actions tutorial showed how to create rule actions and UI actions.
The tutorial created a UI action called "Set Web Flag" that toggles a flag used
to determine whether or not the whitepaper should be shown on the web site.</li>
<li>The custom behavior tutorial showed how to create business logic associated
with a type or aspect. In that tutorial, a custom content model defines a new
"rateable" aspect and a custom behavior is bound to that aspect that knows how
to calculate the average user rating for a given piece of content. The
calculation gets triggered every time a rating is created or deleted. The
tutorial used unit tests and a quick-and-dirty web script to create ratings.</li>
</ul>
<p>SomeCo is now ready to move to the next step: Exposing the rating functionality
on the Alfresco back-end as an API to the front-end. In their infinite wisdom,
the team at SomeCo realizes that Alfresco's web script framework provides a nice
way to expose a lightweight, RESTful API for working with whitepapers and
ratings. The API can be used by SomeCo's front-end web site developers to
retrieve whitepapers and let end-users rate those whitepapers.</p>
<p>In this tutorial, you'll learn how to roll your own REST API on top of Alfresco.
The API will be used for:</p>
<ul>
<li>retrieving a list of whitepapers,</li>
<li>retrieving the average rating for a given whitepaper,</li>
<li>retrieving a specific rating,</li>
<li>posting a new rating for a whitepaper, and</li>
<li>deleting all ratings for a given whitepaper.</li>
</ul>
<p>As you'll learn shortly, web scripts can be written in either server-side
JavaScript or Java. This tutorial will use JavaScript for most of the controller
logic but you'll see how to use Java as well.</p>
<p>The complete source code that accompanies this tutorial is available at <a href="http://github.com/jpotts/alfresco-developer-series">GitHub</a>.</p>
<p>Sound decent? Okay, let's get started.</p>
<h1 id="what-is-the-web-script-framework">What is the Web Script Framework?<a class="headerlink" href="#what-is-the-web-script-framework" title="Permanent link">&para;</a></h1>
<p>In today's everything-as-a-service environment, the CMS is increasingly seen as
a black-box component. Other systems, both producers and consumers of content,
need to interact with the CMS and other components via REST.</p>
<p>Alfresco provides an industry-standard, RESTful API for working with the
repository called CMIS. Starting in release 5.2, they added a new proprietary
RESTful API. But there are times when these APIs don't do everything
you need to do. In that case, a great alternative is to create your own API
using the web script framework.</p>
<p>Think of a web script as a chunk of code that is mapped to a human-readable URL.
So, for example, a URL that returns expense reports pending approval might look
like:</p>
<div class="highlight"><pre><span></span><code>/alfresco/service/expenses/pending
</code></pre></div>
<p>while a URL that returns expenses pending approval for a specific user might
look like:</p>
<div class="highlight"><pre><span></span><code>/alfresco/service/expenses/pending/jpotts
</code></pre></div>
<p>In the URL above, you could read the “jpotts” component of the URL as an implied
argument. A more explicit way to provide an argument would be like:</p>
<div class="highlight"><pre><span></span><code>/alfresco/service/expenses/pending?user=jpotts
</code></pre></div>
<p>Or maybe “pending” is an argument as well which tells the web script what status
of expense reports to return. The point is that the structure of the URL and how
(and if) your URL includes arguments is completely up to you.</p>
<p>The response the URL returns is also up to you. Your response might return HTML,
XML, JSON, or even a JSR-168 Portlet.</p>
<p>The web script framework makes it easy to follow the Model-View-Controller (MVC)
pattern, although it isn't required. The <strong>controller</strong> is server-side
JavaScript, a Java class, or both. The controller handles the request, performs
any business logic that is needed, populates the model with data, and then
forwards the request to the <strong>view</strong>. The view is a FreeMarker template
responsible for constructing a response in the appropriate format. The <strong>model</strong>
is a data structure passed between the controller and the view.</p>
<p>The mapping of URL to controller is done through an XML <em>descriptor</em> which is
responsible for declaring the URL pattern, whether the script requires a
transaction or not, and the authentication requirements for the script. The
descriptor optionally describes arguments that can be passed to the script as
well as the response formats that are available.</p>
<p>The response formats are mapped to FreeMarker templates through naming
convention. So, for example, the FreeMarker template that returns expenses as
HTML would be named with an extension of “html” while the one that returns XML
would be named with an extension of “xml”.</p>
<p>The descriptor, the server-side JavaScript controller, and the FreeMarker
templates that collectively make up a web script can reside either in the
Alfresco content repository or on the file system. If a web script controller
is written in Java, the class must reside somewhere on the classpath.</p>
<p>With these very basic building blocks you can build a lot of cool stuff. For
example, you can use web scripts to expose the Alfresco content repository
through a RESTful API to:</p>
<ul>
<li>Enable a front-end web application written in any language that can talk HTTP
to retrieve repository data in XML, JSON, or any other format or to persist data
to the repository;</li>
<li>Populate JSR-168 portlets;</li>
<li>Capture user-contributed content/data;</li>
<li>Create ATOM or RSS feeds for repository content or business process data; and</li>
<li>Respond to requests for data from the Alfresco Share front-end.</li>
</ul>
<p>The last thing to mention is that web scripts are executed in a “web script
runtime”. There are three runtimes available out-of-the-box:</p>
<ol>
<li>The servlet runtime executes all web scripts requested
via HTTP/S.</li>
<li>The JSF runtime allows JSF components to execute scripts.</li>
<li>The JSR-168 runtime allows portlets to invoke web scripts directly.</li>
</ol>
<p>You can write your own runtime if these don't meet your needs. Alfresco
may add more in the future. This tutorial focuses exclusively on the servlet
runtime.</p>
<h1 id="your-first-web-script">Your First Web Script<a class="headerlink" href="#your-first-web-script" title="Permanent link">&para;</a></h1>
<p>Let's walk through some examples. You're going to start with a very
simple "Hello World" web script. After that, the examples will get progressively
more complex until, at the end, you will have a REST-based interface for
creating, reading, and deleting SomeCo whitepaper ratings.</p>
<h2 id="hello-world-example">Hello World Example<a class="headerlink" href="#hello-world-example" title="Permanent link">&para;</a></h2>
<p>Let's implement the most basic web script possible: A "Hello World" script that
echoes back an argument. You'll need one descriptor and one FreeMarker template.
Do the following:</p>
<ol>
<li>Log in to Alfresco Share as an administrator.</li>
<li>In the Repository, navigate to /Company Home/Data Dictionary/Web Scripts.</li>
<li>
<p>Create a file called helloworld.get.desc.xml with the following
    content:</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;webscript&gt;</span>
<span class="w">    </span><span class="nt">&lt;shortname&gt;</span>Hello<span class="w"> </span>World<span class="nt">&lt;/shortname&gt;</span>
<span class="w">    </span><span class="nt">&lt;description&gt;</span>Hello<span class="w"> </span>world<span class="w"> </span>web<span class="w"> </span>script<span class="nt">&lt;/description&gt;</span>
<span class="w">    </span><span class="nt">&lt;url&gt;</span>/someco/helloworld?name={nameArgument}<span class="nt">&lt;/url&gt;</span>
<span class="nt">&lt;/webscript&gt;</span>
</code></pre></div>
</li>
<li>
<p>Create a file called helloworld.get.html.ftl with the following
    content:</p>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Hello, ${args.name}!<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div>
</li>
<li>
<p>Go to <a href="http://localhost:8080/alfresco/service/index">http://localhost:8080/alfresco/service/index</a> and press the
    "Refresh Web Scripts" button. If you then click the “List Web Scripts” link
    you should be able to find the web script you just defined.</p>
</li>
<li>
<p>Now go to <a href="http://localhost:8080/alfresco/service/someco/helloworld?name=Jeff">http://localhost:8080/alfresco/service/someco/helloworld?name=Jeff</a>. You
    should see:</p>
<div class="highlight"><pre><span></span><code>Hello, Jeff!
</code></pre></div>
<p>Notice that the URL starts with "/alfresco/service" but the descriptor you
created in step 3 defines the URL to be "/someco/helloworld". When you are
invoking web scripts running in Alfresco over HTTP/S, the URL will always
start with "/[alfresco web context]/service". You may also see the "service"
part shortened to "s".</p>
</li>
</ol>
<p>A few things to note. First, notice the file names include “get”. That's the
HTTP method used to call the URL. In later examples you'll see how to use POST
and DELETE. By differentiating on the HTTP method, you can have multiple
controllers for the same “service” depending on which method is used to call the
service.</p>
<p>The second thing to notice is that there is only one argument being passed in.
You can have as many as you want. Just remember that descriptors must be valid
XML which means ampersands must be escaped. So the proper way to define a URL
with multiple arguments is:</p>
<div class="highlight"><pre><span></span><code>&lt;url&gt;/someco/helloworld?name={nameArgument}&amp;amp;secondArg={anotherArg}&lt;/url&gt;
</code></pre></div>
<p>You can also signify optional parameters by adding a question mark, like this:</p>
<div class="highlight"><pre><span></span><code>&lt;url&gt;/someco/helloworld?name={nameArgument}&amp;amp;secondArg={anotherArg?}&lt;/url&gt;
</code></pre></div>
<p>Third, notice that this web script consists only of a descriptor and a
FreeMarker template. It's got a view but not a controller. The web script still
ran because controllers are optional.</p>
<p>Most web scripts are going to use a controller, though, so go ahead and add one.</p>
<ol>
<li>
<p>Create a file called helloworld.get.js with the following content:</p>
<div class="highlight"><pre><span></span><code><span class="nx">model</span><span class="p">.</span><span class="nx">foo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;bar&quot;</span><span class="p">;</span>
</code></pre></div>
</li>
<li>
<p>Update your helloworld.get.html.ftl file with the following content:</p>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Hello, ${args.name}!<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Foo: ${foo}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div>
</li>
<li>
<p>Web scripts with controllers that are being run out of the Data Dictionary
    require a security context. If you were to try to run this web script now
    you'd see an Error 500 to that effect. To fix this, modify your descriptor
    to add an authentication element, like this:</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;webscript&gt;</span>
<span class="w">    </span><span class="nt">&lt;shortname&gt;</span>Hello<span class="w"> </span>World<span class="nt">&lt;/shortname&gt;</span>
<span class="w">    </span><span class="nt">&lt;description&gt;</span>Hello<span class="w"> </span>world<span class="w"> </span>web<span class="w"> </span>script<span class="nt">&lt;/description&gt;</span>
<span class="w">    </span><span class="nt">&lt;url&gt;</span>/someco/helloworld?name={nameArgument}<span class="nt">&lt;/url&gt;</span>
<span class="w">    </span><span class="nt">&lt;authentication&gt;</span>guest<span class="nt">&lt;/authentication&gt;</span>
<span class="nt">&lt;/webscript&gt;</span>
</code></pre></div>
</li>
<li>
<p>Go to <a href="http://localhost:8080/alfresco/service/index">http://localhost:8080/alfresco/service/index</a> and press the
    "Refresh Web Scripts" button. This is required because you added a
    controller that the web script run-time didn't know about.</p>
</li>
<li>
<p>Now go to your web browser and enter the same URL from the first example
    which was <a href="http://localhost:8080/alfresco/service/someco/helloworld?name=Jeff">http://localhost:8080/alfresco/service/someco/helloworld?name=Jeff</a>. You
    should see:</p>
<div class="highlight"><pre><span></span><code>Hello, Jeff!

Foo: bar
</code></pre></div>
<p>If you enter this URL in the same browser as you used to refresh the web
scripts, it will run successfully because you already have a session
established as an administrator. If you open a new browser window and enter
the URL you will get challenged with an authentication dialog. Because you
modified the descriptor to run as guest or higher, you can avoid the dialog
by appending <code>&amp;guest=true</code> to the end of the web script URL.</p>
</li>
</ol>
<p>The web script framework executed the controller. The controller populated the
model with a variable called "foo". The web script framework then passed the
model on to the view, implemented by the FreeMarker template. The view can
access any variables that are placed in the model. In this case, it output the
value of <code>foo</code>. It also has access to the arguments passed to the web script.</p>
<p>The controller can do anything the Alfresco JavaScript API can do. In this case,
the controller didn't leverage the JavaScript API at all—it just put some data
into the “model” object which was then read by the FreeMarker template. In
subsequent examples the controller will have more work to do. Later, you'll see
how to use Java instead of JavaScript for the controller.</p>
<h3 id="deploying-web-scripts-to-the-repository-versus-deploying-to-the-classpath">Deploying web scripts to the repository versus deploying to the classpath<a class="headerlink" href="#deploying-web-scripts-to-the-repository-versus-deploying-to-the-classpath" title="Permanent link">&para;</a></h3>
<p>In this quick example you created the descriptor, controller, and view directly
in the Alfresco repository through the Alfresco Share user interface. Most of
the time, though, you'll be creating several web scripts that will be part of a
larger project. Uploading all of those files to an Alfresco production
environment leaves an opportunity for error. So, for the rest of the tutorial
you'll be deploying your web scripts to the classpath on the file system.</p>
<p>The advantage of using the file system is that the web scripts that make up your
solution can be deployed alongside your other extensions without requiring
anyone to manually upload them to the repository. The disadvantage is that some
changes may require a server restart.</p>
<p>If the same web scripts are defined in the repository as well as the classpath,
the files in the repository take precedence over the files on the classpath.
The Alfresco wiki documents the search order for web scripts (See “Where to find
more information” at the end of this tutorial for a list of references).</p>
<h3 id="using-the-web-scripts-console">Using the web scripts console<a class="headerlink" href="#using-the-web-scripts-console" title="Permanent link">&para;</a></h3>
<p>As you just saw when you refreshed the list of web scripts, Alfresco comes with
a tool for listing and reloading web script definitions. To get to the tool, go
to <a href="http://localhost:8080/alfresco/service/index">http://localhost:8080/alfresco/service/index</a>. You'll see links that let you
browse the list of deployed web scripts. This is a handy debugging tool and it
also helps you figure out what web scripts are available out-of-the-box.</p>
<p>You have seen how to create a very simple web script using files created in a
text editor or directly in the Alfresco Share user interface. Let's talk about
the tools and the project organization next.</p>
<h1 id="setup">Setup<a class="headerlink" href="#setup" title="Permanent link">&para;</a></h1>
<p>Before getting too far down the road, let me tell you about the tools you'll
need and then give you a description of the project organization.</p>
<h2 id="tools">Tools<a class="headerlink" href="#tools" title="Permanent link">&para;</a></h2>
<p>Here is what I am using on my machine:</p>
<ul>
<li>MacOS 11.4</li>
<li>Java OpenJDK 11.0.2</li>
<li>Apache Maven 3.8.1</li>
<li>Alfresco Maven SDK 4.2 (No download necessary)</li>
<li>Docker 20.10.6</li>
<li>Docker Compose 1.29.1</li>
</ul>
<p>By default, when you create an Alfresco project using the Alfresco Maven
SDK the project will be configured to depend on the latest stable Alfresco
Community Edition build.</p>
<p>An IDE is optional. Most people working with Alfresco use IntelliJ, Eclipse or
something similar.</p>
<h2 id="project-organization">Project Organization<a class="headerlink" href="#project-organization" title="Permanent link">&para;</a></h2>
<p>You just saw that web scripts can be created by creating or uploading files to
the Alfresco repository. For the rest of these examples, though, you'll create a
project that will package the web scripts as an AMP (Alfresco Module Package).
This is the recommended way to distribute your Alfresco customizations. It's a
lot less error-prone than handing a bunch of files to someone and asking them to
upload them to the proper place in the repository.</p>
<p>I am not going to spend much time talking about how the Alfresco Maven SDK
works. If you aren't already familiar with it, you may want to read the
<a href="https://ecmarchitect.com/alfresco-developer-series">Getting Started with the Alfresco Maven SDK</a>
tutorial on ecmarchitect.com first and then come back to this one.</p>
<p>If you are planning on following along, go ahead and use the Alfresco Maven SDK
to bootstrap your project using the "alfresco-allinone-archetype" archetype. Use
a <code>groupId</code> of "com.someco" and an <code>artifactId</code> of "webscripts-tutorial".</p>
<p>I'll refer to the directory where you created the project directory as
$TUTORIAL_HOME.</p>
<p>One small change is necessary before continuing. Starting with SDK 3.0.0, the
default is to output a JAR. But we always want to output AMPs. To configure the
project to generate AMPs, edit the pom.xml and uncomment the
maven-assembly-plugin.</p>
<p>Next, there are a few dependencies we need to take care of. First, when running
the project, we want the webscripts-tutorial AMPs to be deployed, but we also
want some of the AMPs from previous tutorials to be deployed as well.
Specifically, the content tutorial, behaviors tutorial, and actions tutorial. To
make this happen, edit the pom.xml in the "webscripts-tutorial-platform-docker"
directory and add the following platform dependencies:</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;dependencies&gt;</span>
<span class="w">    </span><span class="nt">&lt;dependency&gt;</span>
<span class="w">        </span><span class="nt">&lt;groupId&gt;</span>com.someco<span class="nt">&lt;/groupId&gt;</span>
<span class="w">        </span><span class="nt">&lt;artifactId&gt;</span>webscripts-tutorial-platform<span class="nt">&lt;/artifactId&gt;</span>
<span class="w">        </span><span class="nt">&lt;version&gt;</span>1.0-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
<span class="w">        </span><span class="nt">&lt;type&gt;</span>amp<span class="nt">&lt;/type&gt;</span>
<span class="w">    </span><span class="nt">&lt;/dependency&gt;</span>
<span class="w">    </span><span class="cm">&lt;!-- Bring in the content tutorial repo AMP so we can run embedded. --&gt;</span>
<span class="w">    </span><span class="nt">&lt;dependency&gt;</span>
<span class="w">        </span><span class="nt">&lt;groupId&gt;</span>com.someco<span class="nt">&lt;/groupId&gt;</span>
<span class="w">        </span><span class="nt">&lt;artifactId&gt;</span>content-tutorial-platform<span class="nt">&lt;/artifactId&gt;</span>
<span class="w">        </span><span class="nt">&lt;version&gt;</span>1.0-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
<span class="w">        </span><span class="nt">&lt;type&gt;</span>amp<span class="nt">&lt;/type&gt;</span>
<span class="w">    </span><span class="nt">&lt;/dependency&gt;</span>
<span class="w">    </span><span class="cm">&lt;!-- Bring in the actions tutorial repo AMP so we can run embedded. --&gt;</span>
<span class="w">    </span><span class="nt">&lt;dependency&gt;</span>
<span class="w">        </span><span class="nt">&lt;groupId&gt;</span>com.someco<span class="nt">&lt;/groupId&gt;</span>
<span class="w">        </span><span class="nt">&lt;artifactId&gt;</span>actions-tutorial-platform<span class="nt">&lt;/artifactId&gt;</span>
<span class="w">        </span><span class="nt">&lt;version&gt;</span>1.0-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
<span class="w">        </span><span class="nt">&lt;type&gt;</span>amp<span class="nt">&lt;/type&gt;</span>
<span class="w">    </span><span class="nt">&lt;/dependency&gt;</span>
<span class="w">    </span><span class="cm">&lt;!-- Bring in the behavior tutorial repo AMP so we can run embedded. --&gt;</span>
<span class="w">    </span><span class="nt">&lt;dependency&gt;</span>
<span class="w">        </span><span class="nt">&lt;groupId&gt;</span>com.someco<span class="nt">&lt;/groupId&gt;</span>
<span class="w">        </span><span class="nt">&lt;artifactId&gt;</span>behavior-tutorial-platform<span class="nt">&lt;/artifactId&gt;</span>
<span class="w">        </span><span class="nt">&lt;version&gt;</span>1.0-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
<span class="w">        </span><span class="nt">&lt;type&gt;</span>amp<span class="nt">&lt;/type&gt;</span>
<span class="w">    </span><span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;/dependencies&gt;</span>
</code></pre></div>
<p>We also want the Share AMPs from those same projects to be installed, so edit
the pom.xml file in the "webscripts-tutorial-share-docker" directory to add the
following Share dependencies:</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;dependencies&gt;</span>
<span class="w">    </span><span class="nt">&lt;dependency&gt;</span>
<span class="w">        </span><span class="nt">&lt;groupId&gt;</span>com.someco<span class="nt">&lt;/groupId&gt;</span>
<span class="w">        </span><span class="nt">&lt;artifactId&gt;</span>webscripts-tutorial-share<span class="nt">&lt;/artifactId&gt;</span>
<span class="w">        </span><span class="nt">&lt;version&gt;</span>1.0-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
<span class="w">        </span><span class="nt">&lt;type&gt;</span>amp<span class="nt">&lt;/type&gt;</span>
<span class="w">    </span><span class="nt">&lt;/dependency&gt;</span>
<span class="w">    </span><span class="cm">&lt;!-- Bring in the content tutorial share AMP so we can run embedded. --&gt;</span>
<span class="w">    </span><span class="nt">&lt;dependency&gt;</span>
<span class="w">        </span><span class="nt">&lt;groupId&gt;</span>com.someco<span class="nt">&lt;/groupId&gt;</span>
<span class="w">        </span><span class="nt">&lt;artifactId&gt;</span>content-tutorial-share<span class="nt">&lt;/artifactId&gt;</span>
<span class="w">        </span><span class="nt">&lt;version&gt;</span>1.0-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
<span class="w">        </span><span class="nt">&lt;type&gt;</span>amp<span class="nt">&lt;/type&gt;</span>
<span class="w">    </span><span class="nt">&lt;/dependency&gt;</span>
<span class="w">    </span><span class="cm">&lt;!-- Bring in the actions tutorial share AMP so we can run embedded. --&gt;</span>
<span class="w">    </span><span class="nt">&lt;dependency&gt;</span>
<span class="w">        </span><span class="nt">&lt;groupId&gt;</span>com.someco<span class="nt">&lt;/groupId&gt;</span>
<span class="w">        </span><span class="nt">&lt;artifactId&gt;</span>actions-tutorial-share<span class="nt">&lt;/artifactId&gt;</span>
<span class="w">        </span><span class="nt">&lt;version&gt;</span>1.0-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
<span class="w">        </span><span class="nt">&lt;type&gt;</span>amp<span class="nt">&lt;/type&gt;</span>
<span class="w">    </span><span class="nt">&lt;/dependency&gt;</span>
<span class="w">    </span><span class="cm">&lt;!-- Bring in the behavior tutorial share AMP so we can run embedded. --&gt;</span>
<span class="w">    </span><span class="nt">&lt;dependency&gt;</span>
<span class="w">        </span><span class="nt">&lt;groupId&gt;</span>com.someco<span class="nt">&lt;/groupId&gt;</span>
<span class="w">        </span><span class="nt">&lt;artifactId&gt;</span>behavior-tutorial-share<span class="nt">&lt;/artifactId&gt;</span>
<span class="w">        </span><span class="nt">&lt;version&gt;</span>1.0-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
<span class="w">        </span><span class="nt">&lt;type&gt;</span>amp<span class="nt">&lt;/type&gt;</span>
<span class="w">    </span><span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;/dependencies&gt;</span>
</code></pre></div>
<p>Finally, the tutorial will have a compile-time dependency on the behavior-tutorial.
To address that, edit the pom.xml under "webscripts-tutorial-platform" and
add the following dependency:</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;dependency&gt;</span>
<span class="w">    </span><span class="nt">&lt;groupId&gt;</span>com.someco<span class="nt">&lt;/groupId&gt;</span>
<span class="w">    </span><span class="nt">&lt;artifactId&gt;</span>behavior-tutorial-platform<span class="nt">&lt;/artifactId&gt;</span>
<span class="w">    </span><span class="nt">&lt;version&gt;</span>1.0-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
<span class="w">    </span><span class="nt">&lt;scope&gt;</span>provided<span class="nt">&lt;/scope&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div>
<p>Now we'll be able to refer to Java classes in the behavior tutorial and when
running the project the correct AMPs will get installed automatically.</p>
<p>If you have not already checked out the source code from the content, behavior,
and actions tutorials, you need to do so, then run <code>mvn install -DskipTests=true</code>
for each so that the artifacts will be installed in your local Maven repo.</p>
<p>Now you're ready to write some web scripts.</p>
<h1 id="creating-your-own-rest-api-for-ratings">Creating Your Own REST API for Ratings<a class="headerlink" href="#creating-your-own-rest-api-for-ratings" title="Permanent link">&para;</a></h1>
<p>SomeCo wants a REST API that front-end developers can use to find whitepapers
and ratings as well as post new ratings. Before diving in, it probably makes
sense to rough out the API.</p>
<table>
<thead>
<tr>
<th>URL</th>
<th>Method</th>
<th>Description</th>
<th>Response Formats</th>
</tr>
</thead>
<tbody>
<tr>
<td>/someco/whitepapers</td>
<td>GET</td>
<td>Returns a list of whitepapers.</td>
<td>HTML, JSON</td>
</tr>
<tr>
<td>/someco/rating?id={id}</td>
<td>GET</td>
<td>Gets the average rating for a given whitepaper by passing in the whitepaper's noderef.</td>
<td>HTML, JSON</td>
</tr>
<tr>
<td>/someco/rating?id={id}&amp;rating={rating}&amp;user={user}</td>
<td>POST</td>
<td>Creates a new rating for the specified whitepaper by passing in a rating value and the user who posted the rating.</td>
<td>HTML, JSON</td>
</tr>
<tr>
<td>/someco/rating?id={id}</td>
<td>DELETE</td>
<td>Deletes all ratings for a specified whitepaper.</td>
<td>HTML</td>
</tr>
</tbody>
</table>
<p>Table: Planned ratings API</p>
<p>The URL pattern must be unique. In this tutorial all URLs will be prefixed with
"someco". Alfresco reserves certain package names and URLs for their own use but
by incorporating things like your domain name into your URLs and package names,
you'll steer clear of those.</p>
<p>When this API is in place, front-end developers can incorporate whitepapers and
user-contributed ratings into the SomeCo web site. The following mockups show
how the front-end team plans to use the API you're going to build to query for
whitepaper and ratings data.</p>
<p><img alt="The index of whitepapers uses an AJAX call to retrieve whitepaper metadata and ratings" src="../images/someco-whitepapers.png" /></p>
<p>You can't tell from the mockups, but the ratings widget is clickable. When
clicked it sends an asynchronous post to the /someco/rating URL described in the
table above. When the whitepaper link is clicked, the page below is displayed.</p>
<p><img alt="The detail page also uses an AJAX call and includes the same ratings widget as well as a download link" src="../images/someco-whitepapers-detail.png" /></p>
<p>I reused the description from the index page for the Executive Summary. In the
real world this would probably be a more lengthy description separate from the
introduction on the index page. The “Download this white paper” link uses the
standard “Download URL” to give the user direct access to the content.</p>
<h2 id="listing-all-whitepapers">Listing all whitepapers<a class="headerlink" href="#listing-all-whitepapers" title="Permanent link">&para;</a></h2>
<p>As a quick review, recall that SomeCo writes whitepapers and manages those
papers with Alfresco. Some whitepapers are published to the web site. A custom
aspect called <code>sc:webable</code> includes a boolean property called <code>sc:isActive</code>.
Whitepapers with the <code>sc:isActive</code> flag set to <code>true</code> should be shown on the
web site.</p>
<p>Let's write a web script that returns all whitepapers. The list of whitepapers
needs to be in two formats: HTML and JSON. HTML will allow you to easily test
the service and JSON will make it easy for code on the front-end to process the
list. This will require four files:</p>
<ol>
<li>one descriptor,</li>
<li>one JavaScript controller,</li>
<li>one FreeMarker template for the HTML response, and</li>
<li>one FreeMarker template for the JSON response.</li>
</ol>
<p>I'll walk you through the descriptor, controller, and the two views.</p>
<h3 id="step-1-write-the-descriptor">Step 1: Write the descriptor<a class="headerlink" href="#step-1-write-the-descriptor" title="Permanent link">&para;</a></h3>
<p>The first step is to create the descriptor file. Web scripts that are deployed
in an AMP go in:</p>
<div class="highlight"><pre><span></span><code>$TUTORIAL_HOME/webscripts-tutorial-platform/src/main/resources/alfresco/extension/templates/webscripts
</code></pre></div>
<p>The Alfresco Maven SDK probably created that directory structure and added an
"alfresco" directory with some demo web scripts. Go ahead and delete the example
web scripts. We don't need those.</p>
<p>The web script framework allows web script assets to be organized in a
hierarchical folder or package structure within that directory. This keeps your
web scripts from colliding with other people's web scripts or Alfresco's. Use a
reverse domain name pattern just like you would for a Java package. This
tutorial will use "com/someco" for its package. This particular web script is
about whitepapers so the files that make up the whitepapers web script will
reside in:</p>
<div class="highlight"><pre><span></span><code>$TUTORIAL_HOME/webscripts-tutorial-platform/src/main/resources/alfresco/extension/templates/webscripts/com/someco/whitepapers
</code></pre></div>
<p>To create the descriptor, create a new XML file called "<a href="https://github.com/jpotts/alfresco-developer-series/blob/master/webscripts/webscripts-tutorial/webscripts-tutorial-platform/src/main/resources/alfresco/extension/templates/webscripts/com/someco/whitepapers/whitepapers.get.desc.xml">whitepapers.get.desc.xml</a>"
in that directory.</p>
<p>Edit the file to have the following content:</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;webscript&gt;</span>
<span class="w">    </span><span class="nt">&lt;shortname&gt;</span>Get<span class="w"> </span>all<span class="w"> </span>whitepapers<span class="nt">&lt;/shortname&gt;</span>
<span class="w">    </span><span class="nt">&lt;description&gt;</span>Returns<span class="w"> </span>a<span class="w"> </span>list<span class="w"> </span>of<span class="w"> </span>active<span class="w"> </span>whitepapers<span class="nt">&lt;/description&gt;</span>
<span class="w">    </span><span class="nt">&lt;url&gt;</span>/someco/whitepapers<span class="nt">&lt;/url&gt;</span>
<span class="w">    </span><span class="nt">&lt;url&gt;</span>/someco/whitepapers.json<span class="nt">&lt;/url&gt;</span>
<span class="w">    </span><span class="nt">&lt;url&gt;</span>/someco/whitepapers.html<span class="nt">&lt;/url&gt;</span>
<span class="w">    </span><span class="nt">&lt;format</span><span class="w"> </span><span class="na">default=</span><span class="s">&quot;json&quot;</span><span class="nt">&gt;</span>extension<span class="nt">&lt;/format&gt;</span>
<span class="w">    </span><span class="nt">&lt;authentication&gt;</span>guest<span class="nt">&lt;/authentication&gt;</span>
<span class="w">    </span><span class="nt">&lt;transaction&gt;</span>none<span class="nt">&lt;/transaction&gt;</span>
<span class="nt">&lt;/webscript&gt;</span>
</code></pre></div>
<p>There are a few elements in this descriptor you didn't see in the Hello World
example. First, notice that there are multiple <code>url</code> elements. There is one
<code>url</code> element for each format plus one without a format. This shows how to
request a different output format from the same base URL. Because the URLs
differ only in format, it isn't strictly required that they be listed in the
descriptor, but it is a good practice.</p>
<p>The <code>format</code> element declares the which extension syntax the web script uses and
defines a default output format. In this case, the web script uses the
“extension” syntax—the extension on the URL specifies the format of the
response. An alternative syntax is to use the “argument” syntax like this:</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;url&gt;</span>/someco/whitepapers?format=json<span class="nt">&lt;/url&gt;</span>
<span class="nt">&lt;url&gt;</span>/someco/whitepapers?format=html<span class="nt">&lt;/url&gt;</span>
</code></pre></div>
<p>Which syntax you use is really up to you. If you want to accept either syntax,
you can use “any” as the format.</p>
<p>Using the <code>format</code> element set to "extension" and the <code>default</code> attribute set to
"json", if someone invokes the URL and passes in the format as an argument
instead of as an extension, they'll get an error 500. If someone invokes the web
script without specifying a format, they'll get a JSON response.</p>
<p>The <code>authentication</code> element declares the minimum level of authentication
required for this script. If your web script access the repository this must be
set to "guest" or higher. Other options are "none", "user", and "admin".</p>
<p>The <code>transaction</code> element specifies the level of transaction required by the
script. Listing whitepapers doesn't need a transaction, so in this example it is
set to "none". Other possible values are:</p>
<ul>
<li><strong>required</strong>: the web script requires a transaction and can be part of an
existing transaction if one has already been started</li>
<li><strong>requiresnew</strong>: the web script must be run in its own new transaction</li>
</ul>
<p>The next step is to write the controller.</p>
<h3 id="step-2-write-the-controller">Step 2: Write the controller<a class="headerlink" href="#step-2-write-the-controller" title="Permanent link">&para;</a></h3>
<p>The controller is where the logic that queries the whitepapers will live. Create
a file called "<a href="https://github.com/jpotts/alfresco-developer-series/blob/master/webscripts/webscripts-tutorial/webscripts-tutorial-platform/src/main/resources/alfresco/extension/templates/webscripts/com/someco/whitepapers/whitepapers.get.js">whitepapers.get.js</a>"
in the same directory as the controller. Edit the file with the following
content:</p>
<div class="highlight"><pre><span></span><code><span class="o">&lt;</span><span class="k">import</span><span class="w"> </span><span class="nx">resource</span><span class="o">=</span><span class="s2">&quot;classpath:alfresco/extension/scripts/rating.js&quot;</span><span class="o">&gt;</span>

<span class="kd">var</span><span class="w"> </span><span class="nx">whitepapers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">search</span><span class="p">.</span><span class="nx">luceneSearch</span><span class="p">(</span><span class="s2">&quot;PATH:\&quot;/app:company_home/cm:Someco/cm:Whitepapers/*\&quot; +TYPE:\&quot;{http://www.someco.com/model/content/1.0}whitepaper\&quot;&quot;</span><span class="p">);</span>

<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">whitepapers</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">whitepapers</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">status</span><span class="p">.</span><span class="nx">code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">404</span><span class="p">;</span>
<span class="w">    </span><span class="nx">status</span><span class="p">.</span><span class="nx">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;No whitepapers found&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="nx">status</span><span class="p">.</span><span class="nx">redirect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">whitepaperInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Array</span><span class="p">();</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">whitepapers</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">var</span><span class="w"> </span><span class="nx">whitepaper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">whitepaperEntry</span><span class="p">(</span><span class="nx">whitepapers</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span>
<span class="w">        </span><span class="nx">getRating</span><span class="p">(</span><span class="nx">whitepapers</span><span class="p">[</span><span class="nx">i</span><span class="p">]));</span>
<span class="w">        </span><span class="nx">whitepaperInfo</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">whitepaper</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">model</span><span class="p">.</span><span class="nx">whitepapers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">whitepaperInfo</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">whitepaperEntry</span><span class="p">(</span><span class="nx">whitepaper</span><span class="p">,</span><span class="w"> </span><span class="nx">rating</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">whitepaper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">whitepaper</span><span class="p">;</span>
<span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">rating</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">rating</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>The first thing to notice about the script is that it imports another script.
The rating.js script was created as part of the <a href="https://ecmarchitect.com/alfresco-developer-series-tutorials/behaviors/tutorial/tutorial.html">custom behaviors tutorial</a>
to contain logic related to ratings.</p>
<p>The next thing to notice is that the script queries the repository using
Lucene to get a list of whitepapers. Look at what happens if there are no
whitepapers found. The response code gets set to 404, which is the standard HTTP
response code for “File not found”. Alfresco has standard response templates for
error codes but you can override them with your own by creating FreeMarker
templates that follow a specific naming convention. For example, you could have
a custom 404 response template for whitepapers by creating a file called
"whitepapers.get.html.404.ftl". See the official Alfresco documentation on
<a href="http://docs.alfresco.com/4.2/topic/com.alfresco.enterprise.doc/concepts/ws-component-name.html">response status code templates</a>
for more information.</p>
<p>The last thing that happens is that the web script builds a new Array for the
results. The <code>model.whitepapers</code> variable could just be set to the <code>whitepapers</code>
variable that contains the query results but I want to add some data to the
result set, so I'm building a new Array and setting that to the model.</p>
<p>The <code>getRating()</code> function that is getting called resides in rating.js, which is
part of the AMP you created in the custom behaviors tutorial. Just for
reference, that function looks like this:</p>
<div class="highlight"><pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">getRating</span><span class="p">(</span><span class="nx">curNode</span><span class="p">,</span><span class="w"> </span><span class="nx">curUser</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">rating</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{};</span>
<span class="w">    </span><span class="nx">rating</span><span class="p">.</span><span class="nx">average</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">curNode</span><span class="p">.</span><span class="nx">properties</span><span class="p">[</span><span class="s2">&quot;{http://www.someco.com/model/ratings/1.0}averageRating&quot;</span><span class="p">];</span>
<span class="w">    </span><span class="nx">rating</span><span class="p">.</span><span class="nx">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">curNode</span><span class="p">.</span><span class="nx">properties</span><span class="p">[</span><span class="s2">&quot;{http://www.someco.com/model/ratings/1.0}ratingCount&quot;</span><span class="p">];</span>
<span class="w">    </span><span class="nx">rating</span><span class="p">.</span><span class="nx">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">getUserRating</span><span class="p">(</span><span class="nx">curNode</span><span class="p">,</span><span class="w"> </span><span class="nx">curUser</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">rating</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>The function simply retrieves the <code>scr:averageRating</code> and <code>scr:ratingCount</code>
properties from the specified node as well as the current user's rating for
this object, and returns everything in a single rating object.</p>
<h3 id="step-3-write-the-views">Step 3: Write the views<a class="headerlink" href="#step-3-write-the-views" title="Permanent link">&para;</a></h3>
<p>Assuming there are items in the search results, the web script will need
FreeMarker templates to return them in the appropriate format. Let's create the
HTML response template first. Create a new file called "<a href="https://github.com/jpotts/alfresco-developer-series/blob/master/webscripts/webscripts-tutorial/webscripts-tutorial-platform/src/main/resources/alfresco/extension/templates/webscripts/com/someco/whitepapers/whitepapers.get.html.ftl">whitepapers.get.html.ftl</a>"
in the same directory as the controller you just created. Edit the file with the
following content:</p>
<div class="highlight"><pre><span></span><code><span class="err">&lt;</span>#assign datetimeformat=&quot;EEE, dd MMM yyyy HH:mm:ss zzz&quot;&gt;
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">h3</span><span class="p">&gt;</span>Whitepapers<span class="p">&lt;/</span><span class="nt">h3</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">table</span><span class="p">&gt;</span>
            <span class="err">&lt;</span>#list whitepapers as child&gt;
                <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">b</span><span class="p">&gt;</span>Name<span class="p">&lt;/</span><span class="nt">b</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>${child.whitepaper.properties.name}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">b</span><span class="p">&gt;</span>Title<span class="p">&lt;/</span><span class="nt">b</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>${child.whitepaper.properties[&quot;cm:title&quot;]!&quot;&quot;}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">b</span><span class="p">&gt;</span>Link<span class="p">&lt;/</span><span class="nt">b</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;${url.serviceContext}/api/node/workspace/SpacesStore/${child.whitepaper.id}/content?guest=true&quot;</span><span class="p">&gt;</span>${url.serviceContext}/api/node/workspace/SpacesStore/${child.whitepaper.id}/content<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">b</span><span class="p">&gt;</span>Type<span class="p">&lt;/</span><span class="nt">b</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>${child.whitepaper.mimetype}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">b</span><span class="p">&gt;</span>Size<span class="p">&lt;/</span><span class="nt">b</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>${child.whitepaper.size}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">b</span><span class="p">&gt;</span>Id<span class="p">&lt;/</span><span class="nt">b</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>${child.whitepaper.id}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">b</span><span class="p">&gt;</span>Description<span class="p">&lt;/</span><span class="nt">b</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="err">&lt;</span>#if child.whitepaper.properties[&quot;cm:description&quot;]?exists
                <span class="err">&amp;&amp;</span> child.whitepaper.properties[&quot;cm:description&quot;] !=
                &quot;&quot;&gt;${child.whitepaper.properties[&quot;cm:description&quot;]}<span class="err">&lt;</span>/#if&gt;<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">b</span><span class="p">&gt;</span>Pub Date<span class="p">&lt;/</span><span class="nt">b</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>${child.whitepaper.properties[&quot;cm:modified&quot;]?string(datetimeformat)}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">b</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;${url.serviceContext}/rating.html?id=${child.whitepaper.id}&amp;guest=true&quot;</span><span class="p">&gt;</span>Rating<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">b</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">table</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
                                <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">b</span><span class="p">&gt;</span>Average<span class="p">&lt;/</span><span class="nt">b</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>${child.rating.average!&quot;0&quot;}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                            <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
                            <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
                                <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">b</span><span class="p">&gt;</span>Count<span class="p">&lt;/</span><span class="nt">b</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                                    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>${child.rating.count!&quot;0&quot;}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                            <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
                        <span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
                <span class="err">&lt;</span>#if !(child.whitepaper == whitepapers?last.whitepaper)&gt;
                    <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
                        <span class="p">&lt;</span><span class="nt">td</span> <span class="na">colspan</span><span class="o">=</span><span class="s">&quot;2&quot;</span> <span class="na">bgcolor</span><span class="o">=</span><span class="s">&quot;999999&quot;</span><span class="p">&gt;</span><span class="ni">&amp;nbsp;</span><span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
                    <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
                <span class="err">&lt;</span>/#if&gt;
            <span class="err">&lt;</span>/#list&gt;
        <span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div>
<p>This template iterates through the query results passed in by the controller,
and builds an HTML table with properties of each whitepaper. (Yes, the table is
ugly. Yes, you could use CSS to spruce it up tremendously or even remove the
table entirely. But for SomeCo, this response template is really for debugging
purposes only and I didn't want to fool with the CSS so a table it is).</p>
<p>Now create the response template for the JSON response. In the same directory
as the HTML response template, create a file called "<a href="https://github.com/jpotts/alfresco-developer-series/blob/master/webscripts/webscripts-tutorial/webscripts-tutorial-platform/src/main/resources/alfresco/extension/templates/webscripts/com/someco/whitepapers/whitepapers.get.json.ftl">whitepapers.get.json.ftl</a>"
with the following content:</p>
<div class="highlight"><pre><span></span><code>&lt;#assign datetimeformat=&quot;EEE, dd MMM yyyy HH:mm:ss zzz&quot;&gt;
{&quot;whitepapers&quot; : [
    &lt;#list whitepapers as child&gt;
        {
            &quot;name&quot; : &quot;${child.whitepaper.properties.name}&quot;,
            &quot;title&quot; : &quot;${child.whitepaper.properties[&quot;cm:title&quot;]}&quot;,
            &quot;link&quot; : &quot;${url.serviceContext}/api/node/workspace/SpacesStore/${child.whitepaper.id}/content&quot;,
            &quot;type&quot; : &quot;${child.whitepaper.mimetype}&quot;,
            &quot;size&quot; : &quot;${child.whitepaper.size}&quot;,
            &quot;id&quot; : &quot;${child.whitepaper.id}&quot;,
            &quot;description&quot; : &quot;&lt;#if child.whitepaper.properties[&quot;cm:description&quot;]?exists &amp;&amp; child.whitepaper.properties[&quot;cm:description&quot;] != &quot;&quot;&gt;${child.whitepaper.properties[&quot;cm:description&quot;]}&lt;/#if&gt;&quot;,
            &quot;pubDate&quot; : &quot;${child.whitepaper.properties[&quot;cm:modified&quot;]?string(datetimeformat)}&quot;,
            &quot;rating&quot; : {
                &quot;average&quot; : &quot;${child.rating.average!&quot;0&quot;}&quot;,
                &quot;count&quot; : &quot;${child.rating.count!&quot;0&quot;}&quot;
            }
        }
        &lt;#if !(child.whitepaper == whitepapers?last.whitepaper)&gt;,&lt;/#if&gt;
    &lt;/#list&gt;
    ]
}
</code></pre></div>
<p>Again, just like the HTML response template, the script iterates through the
result set, but this one outputs JSON instead of HTML. The JSON structure is
completely arbitrary. In the real world, you would work this out with the
front-end development team.</p>
<h3 id="deploying-the-whitepaper-web-script">Deploying the whitepaper web script<a class="headerlink" href="#deploying-the-whitepaper-web-script" title="Permanent link">&para;</a></h3>
<p>Recall that after you bootstrapped this project from the "all-in-one" archetype,
you edited the pom.xml file to add the content, behavior, and actions AMPs as
dependencies. That means you can easily test your web script by firing up the
Docker containers and your webscripts will have the dependencies they expect.
Plus, you'll be able to log in to Share and create test content, run the
custom actions from the actions tutorial, and so on.</p>
<p>The dependencies from the earlier tutorials do the following:</p>
<ul>
<li><strong>content-tutorial-platform</strong>. This is required because the web script
looks for content with the <code>sc:isActive</code> flag set and that's defined in the
SomeCo Content Model that is part of that project.</li>
<li><strong>behavior-tutorial-platform</strong>. This is required because it contains a
behavior that calculates the average rating for a piece of content and because
it has the rating.js server-side JavaScript file that the controllers in this
tutorial import.</li>
<li><strong>actions-tutorial-platform</strong>. This one is optional. It contains a UI
action that is used to set the <code>sc:isActive</code> flag from within the Alfresco Share
user interface.</li>
</ul>
<p>Running the SDK-generated Docker containers with these dependencies installed
automatically for you is really convenient. At some point, you'll want to deploy
to an actual Alfresco installation, which you can do either by manually
deploying the AMPs for this project and the ones listed above or by building
your own Docker images.</p>
<p>For now, it's easiest just to use the SDK-generated Docker containers. To start
those up using Docker Compose, switch to the "webscripts-tutorial" directory and
run <code>./run.sh build_start</code> or <code>run.bat build_start</code> depending on your platform.</p>
<p>Now that your Alfresco server is running the webscripts-tutorial-platform
AMP and its dependencies, you are ready to test out the whitepapers web script.</p>
<h3 id="testing">Testing<a class="headerlink" href="#testing" title="Permanent link">&para;</a></h3>
<p>You've deployed the project and its dependencies to your Alfresco installation
and the server is running. You are now ready to test out the web script. Do
this:</p>
<ol>
<li>Upload some files to your Alfresco repository. It doesn't matter what they
are. The files should go in "Company Home/Someco/Whitepapers". Capitalization
matters.</li>
<li>Change the type on the files you uploaded to "SomeCo Whitepaper". You can
save time if you set that up as a rule on your Whitepapers folder before you
upload your test files in step 1.</li>
<li>If you are going to run the web script as a guest user, make sure that
"Guest" is given "Consumer" access to the Whitepapers folder.</li>
</ol>
<p>The web script descriptor says that this web script requires Guest access or
higher. That means you have three options for running the web script:</p>
<ol>
<li>Log in to Alfresco (/alfresco) before running the web script.</li>
<li>Run the web script and then authenticate with a valid user and password when
the basic authentication dialog is presented.</li>
<li>
<p>Run the web script with “?guest=true” appended to the URL, like this:</p>
<p>http://localhost:8080/alfresco/service/someco/whitepapers.html?guest=true</p>
</li>
</ol>
<p>It doesn't matter which one you choose. The tutorial assumes you are going with
option 3.</p>
<p>If you forget the ".html" extension in the URL, you'll get a JSON response
because the descriptor set that format as the default.</p>
<p>If all goes well you should see something similar to the figure below:</p>
<p><img alt="The whitepapers list output by the web script" src="../images/whitepapers.png" /></p>
<h3 id="debugging">Debugging<a class="headerlink" href="#debugging" title="Permanent link">&para;</a></h3>
<p>Did it work? If not, it's time to debug. Debug logging verbosity is controlled
by log4j.properties. There are many log4j.properties files. For turning on
JavaScript logging, edit the one in:</p>
<div class="highlight"><pre><span></span><code>$TOMCAT_HOME/webapps/alfresco/WEB-INF/classes
</code></pre></div>
<p>Edit log4j.properties and change the ScriptLogger to DEBUG, like this:</p>
<div class="highlight"><pre><span></span><code>log4j.logger.org.alfresco.repo.jscript.ScriptLogger=DEBUG
</code></pre></div>
<p>This will cause any logger.log statements in your controller to write to
catalina.out. If that isn't enough logging for you, you can set:</p>
<div class="highlight"><pre><span></span><code>log4j.logger.org.alfresco.repo.jscript=DEBUG
</code></pre></div>
<p>That will give you debug logging on all server-side JavaScript.</p>
<p>You may decide that you need to step through your server-side JavaScript.
Assuming your server is running on a machine with a GUI, you can edit
log4j.properties and set:</p>
<div class="highlight"><pre><span></span><code>log4j.logger.org.alfresco.repo.web.scripts.AlfrescoRhinoScriptDebugger=on
</code></pre></div>
<p>Then, when you restart your application server, Alfresco will launch the Rhino
JavaScript Debugger in a GUI. You can use it to set breakpoints and step through
your JavaScript controller.</p>
<p>Another tool you'll want to leverage is the web script console. The web script
console is at:</p>
<div class="highlight"><pre><span></span><code>http://localhost:8080/alfresco/service/index
</code></pre></div>
<p>You can use it to see everything Alfresco knows about your script (and any other
scripts it knows about). For example, you can go to:</p>
<div class="highlight"><pre><span></span><code>http://localhost:8080/alfresco/service/script/com/someco/whitepapers/whitepapers.get
</code></pre></div>
<p>and Alfresco will dump everything it knows about that web script, including the
descriptor, the controller, and all of the response templates.</p>
<p>The node browser in Alfresco Share Admin Tools can be helpful to debug problems
as well. You can get to it by going to:</p>
<div class="highlight"><pre><span></span><code>http://localhost:8080/share/page/console/admin-console/node-browser
</code></pre></div>
<p>In this case, for example, the JavaScript controller runs a Lucene query. If the
controller isn't finding any whitepapers even though you've created test
data, try executing the query in the node browser. If it doesn't return
results, there's something wrong with your test data (or your query). You can
use the node browser to navigate to the test data and inspect its type, aspects,
and property values.</p>
<p>Remember that if you make changes to the web script without restarting the
application server, you may need to use the web script console to refresh the
web scripts.</p>
<h2 id="retrieving-the-ratings-for-a-specific-whitepaper">Retrieving the ratings for a specific whitepaper<a class="headerlink" href="#retrieving-the-ratings-for-a-specific-whitepaper" title="Permanent link">&para;</a></h2>
<p>You have a working web script that fetches a list of whitepapers. Now let's
create a web script that retrieves rating summary data for a specific object.</p>
<p>This is pretty easy because of the existing <code>getRating()</code> function in
rating.js. The controller is called "<a href="https://github.com/jpotts/alfresco-developer-series/blob/master/webscripts/webscripts-tutorial/webscripts-tutorial-platform/src/main/resources/alfresco/extension/templates/webscripts/com/someco/ratings/rating.get.js">rating.get.js</a>"
and it resides in:</p>
<div class="highlight"><pre><span></span><code>$TUTORIAL_HOME/webscripts-tutorial-platform/src/main/resources/alfresco/extension/templates/webscripts/com/someco/ratings
</code></pre></div>
<p>All the controller has to do is grab the ID of the rateable object that is being
requested, locate
the node, then call <code>getRating()</code> as shown below:</p>
<div class="highlight"><pre><span></span><code><span class="o">&lt;</span><span class="k">import</span><span class="w"> </span><span class="nx">resource</span><span class="o">=</span><span class="s2">&quot;classpath:alfresco/module/behavior-tutorial-platform/scripts/rating.js&quot;</span><span class="o">&gt;</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">args</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">args</span><span class="p">.</span><span class="nx">id</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">status</span><span class="p">.</span><span class="nx">code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">400</span><span class="p">;</span>
<span class="w">    </span><span class="nx">status</span><span class="p">.</span><span class="nx">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Node ID has not been provided&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="nx">status</span><span class="p">.</span><span class="nx">redirect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">curNode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">search</span><span class="p">.</span><span class="nx">findNode</span><span class="p">(</span><span class="s2">&quot;workspace://SpacesStore/&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">args</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">curNode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">status</span><span class="p">.</span><span class="nx">code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">404</span><span class="p">;</span>
<span class="w">        </span><span class="nx">status</span><span class="p">.</span><span class="nx">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;No node found for id:&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">args</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
<span class="w">        </span><span class="nx">status</span><span class="p">.</span><span class="nx">redirect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">model</span><span class="p">.</span><span class="nx">rating</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">getRating</span><span class="p">(</span><span class="nx">curNode</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">.</span><span class="nx">user</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>The descriptor and response templates are very similar to the whitepaper
example so I won't include them here. If you want to grab them to copy them into
your project, they are:</p>
<ul>
<li><a href="https://github.com/jpotts/alfresco-developer-series/blob/master/webscripts/webscripts-tutorial/webscripts-tutorial-platform/src/main/resources/alfresco/extension/templates/webscripts/com/someco/ratings/rating.get.desc.xml">rating.get.desc.xml</a></li>
<li><a href="https://github.com/jpotts/alfresco-developer-series/blob/master/webscripts/webscripts-tutorial/webscripts-tutorial-platform/src/main/resources/alfresco/extension/templates/webscripts/com/someco/ratings/rating.get.html.ftl">rating.get.html.ftl</a></li>
<li><a href="https://github.com/jpotts/alfresco-developer-series/blob/master/webscripts/webscripts-tutorial/webscripts-tutorial-platform/src/main/resources/alfresco/extension/templates/webscripts/com/someco/ratings/rating.get.json.ftl">rating.get.json.ftl</a></li>
</ul>
<p>Now you can deploy and test the rating web script.</p>
<h3 id="deploying-and-testing-the-rating-web-script">Deploying and testing the rating web script<a class="headerlink" href="#deploying-and-testing-the-rating-web-script" title="Permanent link">&para;</a></h3>
<p>If you are following along, build the AMPs by running <code>mvn install -DskipTests</code>
from the $TUTORIAL_HOME directory. Once it builds successfully, you can restart
the Alfresco container by running <code>./run.sh reload_acs</code>.</p>
<p>Now invoke the whitepaper web script you created earlier:</p>
<div class="highlight"><pre><span></span><code>http://localhost:8080/alfresco/service/someco/whitepapers.html&amp;guest=true
</code></pre></div>
<p>The HTML the whitepaper web script returns includes a link that invokes your new
rating web script for a specific whitepaper. The link should look similar to:</p>
<div class="highlight"><pre><span></span><code>http://localhost:8080/alfresco/s/someco/rating.html?id=43946f68-1fc6-4d54-b730-33a20633b432&amp;guest=true
</code></pre></div>
<p>If you change the ".html" suffix to ".json", the result should look like this:</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;rating&quot;</span><span class="w"> </span><span class="p">:</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;average&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1.923&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;count&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;13&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Now you have a web script that can retrieve the rating information for a
specific object. Next, you'll add a web script that creates new ratings.</p>
<h2 id="posting-a-rating-with-a-java-backed-web-script">Posting a rating with a Java-backed Web Script<a class="headerlink" href="#posting-a-rating-with-a-java-backed-web-script" title="Permanent link">&para;</a></h2>
<p>You have seen how to retrieve whitepapers and rating data about specific
whitepapers. Now let's create a web script that can create ratings. But first,
a few words about authentication.</p>
<p>All of the web scripts created thus far require Guest access or
higher. As you've seen, that means the URL has to include "&amp;guest=true" or a
session has to be established with a valid login. (A third option would be to
pass in a ticket, but that's out-of-scope for this tutorial).</p>
<p>Remember that the goal here is for SomeCo to let users come to its web site,
retrieve whitepapers, and rate whitepapers. How will SomeCo web site users be
authorized to create whitepaper rating objects? There are three options:</p>
<ol>
<li>Set the permissions to allow write access for Guest users on the /Someco/Whitepapers
folder. This isn't a good option because SomeCo doesn't want Guests to be able
to upload arbitrary content to their repository.</li>
<li>Set the web script descriptor to use "user" authentication and require Guests
to authenticate as registered users before rating whitepapers. This isn't a
terrible option but SomeCo doesn't want their web site users to have to register
for an account and login before rating whitepapers.</li>
<li>Let guest users call the web script but tell Alfresco to run the web script
as a specific user that <em>does</em> have authorization to create new objects. In this
case that user will be "admin" but a user account dedicated to the purpose of
creating ratings is probably a better idea in the real world.</li>
</ol>
<p>Option 3 is the one SomeCo chooses to go with.</p>
<p>Although it isn't required, this example will use a Java-based controller
instead of server-side JavaScript so you can see how that works. Even though
Java will be used, the steps are the same at a high-level:</p>
<ol>
<li>Write the descriptor</li>
<li>Write the Java controller</li>
<li>Write the views</li>
</ol>
<p>The descriptor, together with the two views, reside in the same folder as the
GET rating web script you worked on in the previous section, which is:</p>
<div class="highlight"><pre><span></span><code>$TUTORIAL_HOME/webscripts-tutorial-platform/src/main/resources/alfresco/extension/templates/webscripts/com/someco/ratings
</code></pre></div>
<p>The controller will be written in the Java source code folder for the project,
compiled, and packaged in a JAR as part of the AMP.</p>
<p>Let's look at each of the steps needed to implement the post rating web script.</p>
<h3 id="step-1-write-the-descriptor_1">Step 1: Write the descriptor<a class="headerlink" href="#step-1-write-the-descriptor_1" title="Permanent link">&para;</a></h3>
<p>The descriptor, <a href="https://github.com/jpotts/alfresco-developer-series/blob/master/webscripts/webscripts-tutorial/webscripts-tutorial-platform/src/main/resources/alfresco/extension/templates/webscripts/com/someco/ratings/rating.post.desc.xml">rating.post.desc.xml</a>, has two things you haven't seen yet. First, the <code>authentication</code> element uses the
<code>runas</code> attribute to specify that the web script should be executed as "admin"
even though it only requires Guest access or higher to execute:</p>
<div class="highlight"><pre><span></span><code>&lt;authentication runas=&quot;admin&quot;&gt;guest&lt;/authentication&gt;
</code></pre></div>
<p>Note that using <code>runas</code> in this way only works for web scripts that are loaded
from the classpath. For security reasons, it will not work for web scripts
uploaded to the repository.</p>
<p>The second piece of the descriptor to look at is the <code>transaction</code> element.
Unlike the GET web scripts you've seen so far, this web script creates new
content so the web script will need a transaction:</p>
<div class="highlight"><pre><span></span><code>&lt;transaction&gt;required&lt;/transaction&gt;
</code></pre></div>
<p>The descriptor will cause Alfresco to invoke the web script as if it were being
run by "admin", regardless of who calls it, and it will run within a
transaction. The next step is to write the Java controller.</p>
<h3 id="step-2-write-the-java-controller">Step 2: Write the Java controller<a class="headerlink" href="#step-2-write-the-java-controller" title="Permanent link">&para;</a></h3>
<p>This step actually has three parts:</p>
<p>a. Write the business logic for creating the rating. That's going to go into a
class that doesn't know anything about web scripts so that it is easier to
reuse.
b. Write a Java class that functions as the web script controller. This class
will do some basic error checking and then call the class created in the
previous step to actually create a rating.
c. Configure the web script controller via Spring so that Alfresco knows to
invoke it when the web script is called.</p>
<p>Let's take a look.</p>
<h4 id="step-2a-write-the-business-logic-for-creating-the-rating">Step 2a: Write the business logic for creating the rating<a class="headerlink" href="#step-2a-write-the-business-logic-for-creating-the-rating" title="Permanent link">&para;</a></h4>
<p>At some point there might be other Java classes that need to create ratings. So
the logic that does that should be generic. This class has a dependency on the
"behavior-tutorial-platform" project created in an earlier tutorial, so the first
thing to do is to edit this project's <a href="https://github.com/jpotts/alfresco-developer-series/blob/master/webscripts/webscripts-tutorial/webscripts-tutorial-platform/pom.xml">pom.xml</a> file, which lives in:</p>
<div class="highlight"><pre><span></span><code>$TUTORIAL_HOME/webscripts-tutorial-platform
</code></pre></div>
<p>And add the dependency, which looks like this:</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;dependency&gt;</span>
<span class="w">    </span><span class="nt">&lt;groupId&gt;</span>com.someco<span class="nt">&lt;/groupId&gt;</span>
<span class="w">    </span><span class="nt">&lt;artifactId&gt;</span>behavior-tutorial-platform<span class="nt">&lt;/artifactId&gt;</span>
<span class="w">    </span><span class="nt">&lt;version&gt;</span>1.0-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
<span class="w">    </span><span class="nt">&lt;scope&gt;</span>provided<span class="nt">&lt;/scope&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div>
<p>Create a new package called "com.someco.beans" in:</p>
<div class="highlight"><pre><span></span><code>$TUTORIAL_HOME/webscripts-tutorial-platform/src/main/java
</code></pre></div>
<p>In that package, create a new class called "<a href="https://github.com/jpotts/alfresco-developer-series/blob/master/webscripts/webscripts-tutorial/webscripts-tutorial-platform/src/main/java/com/someco/beans/RatingBean.java">RatingBean</a>".
The class (without the imports) looks like this:</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">RatingBean</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="c1">// Dependencies</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">NodeService</span><span class="w"> </span><span class="n">nodeService</span><span class="p">;</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">create</span><span class="p">(</span><span class="kd">final</span><span class="w"> </span><span class="n">NodeRef</span><span class="w"> </span><span class="n">nodeRef</span><span class="p">,</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">rating</span><span class="p">,</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">user</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// add the aspect to this document if it needs it</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">nodeService</span><span class="p">.</span><span class="na">hasAspect</span><span class="p">(</span><span class="n">nodeRef</span><span class="p">,</span><span class="w"> </span><span class="n">QName</span><span class="p">.</span><span class="na">createQName</span><span class="p">(</span><span class="n">SomeCoRatingsModel</span><span class="p">.</span><span class="na">NAMESPACE_SOMECO_RATINGS_CONTENT_MODEL</span><span class="p">,</span><span class="w"> </span><span class="n">SomeCoRatingsModel</span><span class="p">.</span><span class="na">ASPECT_SCR_RATEABLE</span><span class="p">)))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">nodeService</span><span class="p">.</span><span class="na">addAspect</span><span class="p">(</span><span class="n">nodeRef</span><span class="p">,</span><span class="w"> </span><span class="n">QName</span><span class="p">.</span><span class="na">createQName</span><span class="p">(</span><span class="n">SomeCoRatingsModel</span><span class="p">.</span><span class="na">NAMESPACE_SOMECO_RATINGS_CONTENT_MODEL</span><span class="p">,</span><span class="w"> </span><span class="n">SomeCoRatingsModel</span><span class="p">.</span><span class="na">ASPECT_SCR_RATEABLE</span><span class="p">),</span><span class="w"> </span><span class="kc">null</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">QName</span><span class="p">,</span><span class="w"> </span><span class="n">Serializable</span><span class="o">&gt;</span><span class="w"> </span><span class="n">props</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">QName</span><span class="p">,</span><span class="w"> </span><span class="n">Serializable</span><span class="o">&gt;</span><span class="p">();</span>
<span class="w">        </span><span class="n">props</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">QName</span><span class="p">.</span><span class="na">createQName</span><span class="p">(</span><span class="n">SomeCoRatingsModel</span><span class="p">.</span><span class="na">NAMESPACE_SOMECO_RATINGS_CONTENT_MODEL</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;rating&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">rating</span><span class="p">);</span>
<span class="w">        </span><span class="n">props</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">QName</span><span class="p">.</span><span class="na">createQName</span><span class="p">(</span><span class="n">SomeCoRatingsModel</span><span class="p">.</span><span class="na">NAMESPACE_SOMECO_RATINGS_CONTENT_MODEL</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;rater&quot;</span><span class="p">),</span><span class="w"> </span><span class="n">user</span><span class="p">);</span>
<span class="w">        </span><span class="n">nodeService</span><span class="p">.</span><span class="na">createNode</span><span class="p">(</span><span class="n">nodeRef</span><span class="p">,</span><span class="w"> </span><span class="n">QName</span><span class="p">.</span><span class="na">createQName</span><span class="p">(</span><span class="n">SomeCoRatingsModel</span><span class="p">.</span><span class="na">NAMESPACE_SOMECO_RATINGS_CONTENT_MODEL</span><span class="p">,</span><span class="w"> </span><span class="n">SomeCoRatingsModel</span><span class="p">.</span><span class="na">ASSN_SCR_RATINGS</span><span class="p">),</span><span class="w"> </span><span class="n">QName</span><span class="p">.</span><span class="na">createQName</span><span class="p">(</span><span class="n">SomeCoRatingsModel</span><span class="p">.</span><span class="na">NAMESPACE_SOMECO_RATINGS_CONTENT_MODEL</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;rating&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Date</span><span class="p">().</span><span class="na">getTime</span><span class="p">()),</span><span class="w"> </span><span class="n">QName</span><span class="p">.</span><span class="na">createQName</span><span class="p">(</span><span class="n">SomeCoRatingsModel</span><span class="p">.</span><span class="na">NAMESPACE_SOMECO_RATINGS_CONTENT_MODEL</span><span class="p">,</span><span class="w"> </span><span class="n">SomeCoRatingsModel</span><span class="p">.</span><span class="na">TYPE_SCR_RATING</span><span class="p">),</span><span class="w"> </span><span class="n">props</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">NodeService</span><span class="w"> </span><span class="nf">getNodeService</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">nodeService</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>


<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setNodeService</span><span class="p">(</span><span class="n">NodeService</span><span class="w"> </span><span class="n">nodeService</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">nodeService</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nodeService</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span><span class="w">    </span>
<span class="p">}</span>
</code></pre></div>
<p>The <code>create()</code> method expects a <code>nodeRef</code> that is being rated, a <code>rating</code>, and
the <code>user</code> creating the rating. The method checks the node to see if it already
has the rateable aspect and adds it if it does not. Then, it sets up the rating
and user properties to be set on the rating object. Finally, it calls
<code>createNode()</code> on the Alfresco node service to create the rating as a child of
the object being rated.</p>
<p>As you can see, this class does not know that it will be invoked by a web
script. It's generic enough to be used by anything that needs to create a
rating.</p>
<p>With that in place, you can now create the Java web script controller.</p>
<h4 id="step-2b-write-the-controller-class">Step 2b: Write the controller class<a class="headerlink" href="#step-2b-write-the-controller-class" title="Permanent link">&para;</a></h4>
<p>The <code>create()</code> method in the <code>RatingBean</code> class provides a handy method for
creating new ratings on any object. Now all we have to do is write a Java
controller for the rating POST web script that grabs the id of the object being
rated, the rating, and the person creating the rating, and pass all of that to
the <code>create()</code> method.</p>
<p>To do that, create a new package called "com.someco.scripts" in:</p>
<div class="highlight"><pre><span></span><code>$TUTORIAL_HOME/webscripts-tutorial-platform/src/main/java
</code></pre></div>
<p>Within that package, create a new class called "<a href="https://github.com/jpotts/alfresco-developer-series/blob/master/webscripts/webscripts-tutorial/webscripts-tutorial-platform/src/main/java/com/someco/scripts/PostRating.java">PostRating</a>".
The class name isn't significant but following a descriptive convention is
helpful as the number of Java-backed web scripts grows.</p>
<p>The class needs to extend <code>org.alfresco.webscripts.DeclarativeWebScript</code>. The
logic goes in <code>executeImpl</code> as shown below.</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">PostRating</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">DeclarativeWebScript</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">RatingBean</span><span class="w"> </span><span class="n">ratingBean</span><span class="p">;</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="n">NodeService</span><span class="w"> </span><span class="n">nodeService</span><span class="p">;</span>

<span class="w">    </span><span class="nd">@Override</span>
<span class="w">    </span><span class="kd">protected</span><span class="w"> </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="nf">executeImpl</span><span class="p">(</span><span class="n">WebScriptRequest</span><span class="w"> </span><span class="n">req</span><span class="p">,</span>
<span class="w">            </span><span class="n">Status</span><span class="w"> </span><span class="n">status</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">req</span><span class="p">.</span><span class="na">getParameter</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">rating</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">req</span><span class="p">.</span><span class="na">getParameter</span><span class="p">(</span><span class="s">&quot;rating&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="n">String</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">req</span><span class="p">.</span><span class="na">getParameter</span><span class="p">(</span><span class="s">&quot;user&quot;</span><span class="p">);</span>

<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">rating</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">rating</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="s">&quot;0&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">status</span><span class="p">.</span><span class="na">setCode</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Required data has not been provided&quot;</span><span class="p">);</span>
<span class="w">            </span><span class="n">status</span><span class="p">.</span><span class="na">setRedirect</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">NodeRef</span><span class="w"> </span><span class="n">curNode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">NodeRef</span><span class="p">(</span><span class="s">&quot;workspace://SpacesStore/&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">id</span><span class="p">);</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">nodeService</span><span class="p">.</span><span class="na">exists</span><span class="p">(</span><span class="n">curNode</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">status</span><span class="p">.</span><span class="na">setCode</span><span class="p">(</span><span class="mi">404</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;No node found for id:&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">id</span><span class="p">);</span>
<span class="w">                </span><span class="n">status</span><span class="p">.</span><span class="na">setRedirect</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">ratingBean</span><span class="p">.</span><span class="na">create</span><span class="p">(</span><span class="n">curNode</span><span class="p">,</span><span class="w"> </span><span class="n">Integer</span><span class="p">.</span><span class="na">parseInt</span><span class="p">(</span><span class="n">rating</span><span class="p">),</span><span class="w"> </span><span class="n">user</span><span class="p">);</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">        </span><span class="p">}</span>

<span class="w">        </span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="o">&gt;</span><span class="w"> </span><span class="n">model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span><span class="w"> </span><span class="n">Object</span><span class="o">&gt;</span><span class="p">();</span>
<span class="w">        </span><span class="n">model</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;node&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">id</span><span class="p">);</span>
<span class="w">        </span><span class="n">model</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;rating&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">rating</span><span class="p">);</span>
<span class="w">        </span><span class="n">model</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">&quot;user&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="p">);</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">model</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">NodeService</span><span class="w"> </span><span class="nf">getNodeService</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">nodeService</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setNodeService</span><span class="p">(</span><span class="n">NodeService</span><span class="w"> </span><span class="n">nodeService</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">nodeService</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nodeService</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="n">RatingBean</span><span class="w"> </span><span class="nf">getRatingBean</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">ratingBean</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">public</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">setRatingBean</span><span class="p">(</span><span class="n">RatingBean</span><span class="w"> </span><span class="n">ratingBean</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="na">ratingBean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ratingBean</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>This code should look strikingly similar to a JavaScript controller and
in fact it does the same thing. It checks the arguments, sets an error
code if the arguments are missing, and then writes some data to the
model.</p>
<p>The controller gets the <code>RatingBean</code> class through Spring dependency
injection.</p>
<p>The next step is to configure both of these Java classes in Spring.</p>
<h4 id="step-2c-create-spring-configuration-for-the-web-script-controller">Step 2c: Create Spring configuration for the web script controller<a class="headerlink" href="#step-2c-create-spring-configuration-for-the-web-script-controller" title="Permanent link">&para;</a></h4>
<p>The Java controller for the web script exists, but both the controller class,
<code>PostRating</code>, and the bean that contains the business logic, <code>RatingBean</code>, have
dependencies that need to be injected. And, the web script framework needs to
know to invoke the <code>PostRating</code> class when the web script is called. All of that
happens through Spring configuration.</p>
<p>You learned in earlier tutorials that the Spring context file for a module is
called <a href="https://github.com/jpotts/alfresco-developer-series/blob/master/webscripts/webscripts-tutorial/webscripts-tutorial-platform/src/main/resources/alfresco/module/webscripts-tutorial-platform/context/service-context.xml">service-context.xml</a>
and it lives in:</p>
<div class="highlight"><pre><span></span><code>$TUTORIAL_HOME/webscripts-tutorial-platform/src/main/resources/alfresco/module/webscripts-tutorial-platform/context
</code></pre></div>
<p>The Alfresco Maven SDK created that file for you when you used it to bootstrap
the project.</p>
<p>Edit that file. You can delete any sample bean elements that may already be in
the file. Make the <code>beans</code> element look like this:</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;beans&gt;</span>
<span class="w">    </span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;ratingBean&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;com.someco.beans.RatingBean&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;nodeService&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;ref</span><span class="w"> </span><span class="na">bean=</span><span class="s">&quot;NodeService&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;/property&gt;</span>
<span class="w">    </span><span class="nt">&lt;/bean&gt;</span>

<span class="w">    </span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;webscript.com.someco.ratings.rating.post&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;com.someco.scripts.PostRating&quot;</span><span class="w"> </span><span class="na">parent=</span><span class="s">&quot;webscript&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;ratingBean&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;ref</span><span class="w"> </span><span class="na">bean=</span><span class="s">&quot;ratingBean&quot;</span><span class="w"> </span><span class="nt">/&gt;</span><span class="w">       </span>
<span class="w">        </span><span class="nt">&lt;/property&gt;</span>
<span class="w">        </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;nodeService&quot;</span><span class="nt">&gt;</span>
<span class="w">            </span><span class="nt">&lt;ref</span><span class="w"> </span><span class="na">bean=</span><span class="s">&quot;NodeService&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;/property&gt;</span>
<span class="w">    </span><span class="nt">&lt;/bean&gt;</span><span class="w">    </span>
<span class="nt">&lt;/beans&gt;</span>
</code></pre></div>
<p>The first <code>bean</code> element is simple--the <code>RatingBean</code> class needs the Alfresco
<code>NodeService</code> so one is being injected.</p>
<p>The second <code>bean</code> element is where the web script framework finds out about the
<code>PostRating</code> class. The magic is in the <code>id</code> and <code>parent</code> attributes. The <code>id</code>
attribute follows a naming convention. The convention is:</p>
<div class="highlight"><pre><span></span><code>webscript.package.service-id.method
</code></pre></div>
<p>Pay close attention to the use of the singular "webscript" here versus the
plural "webscripts" in other places. Accidentally using the plural form here is
a potential multi-hour debugging session ending in a forehead slap and a “Doh!”
if you aren't careful.</p>
<p>It is probably worth mentioning that a decision to use a Java-backed web script
doesn't exclude the use of JavaScript for the same web script. If you have both
a Java class and a JavaScript file for the same web script, the Java class gets
executed first followed by the JavaScript. The script has access to everything
the Java class put in the model and can update the model before passing it along
to the view. Implementing both a Java-based controller and a JavaScript-based
controller for the same web script is potentially confusing to you and the rest
of your team so don't do it unless you have good reason, and if you do make sure
to document it well.</p>
<h3 id="step-3-write-the-views_1">Step 3: Write the views<a class="headerlink" href="#step-3-write-the-views_1" title="Permanent link">&para;</a></h3>
<p>The response templates for this web script look like the examples you've seen so
far. Like previous examples, this web script can respond with either an HTML or
JSON response:</p>
<ul>
<li><a href="https://github.com/jpotts/alfresco-developer-series/blob/master/webscripts/webscripts-tutorial/webscripts-tutorial-platform/src/main/resources/alfresco/extension/templates/webscripts/com/someco/ratings/rating.post.html.ftl">rating.post.html.ftl</a></li>
<li><a href="https://github.com/jpotts/alfresco-developer-series/blob/master/webscripts/webscripts-tutorial/webscripts-tutorial-platform/src/main/resources/alfresco/extension/templates/webscripts/com/someco/ratings/rating.post.json.ftl">rating.post.json.ftl</a></li>
</ul>
<p>These should look similar to the views you've already created.</p>
<h3 id="deploying-the-post-web-script">Deploying the post web script<a class="headerlink" href="#deploying-the-post-web-script" title="Permanent link">&para;</a></h3>
<p>This web script is written in Java so you'll need to shutdown the server, build
the AMP, and deploy it to your Alfresco server as you've done in prior steps,
then start Tomcat back up.</p>
<h3 id="testing-the-post-web-script-with-curl">Testing the post web script with curl<a class="headerlink" href="#testing-the-post-web-script-with-curl" title="Permanent link">&para;</a></h3>
<p>Curl, and other types of HTTP clients, are great for testing web scripts. For
example, using curl you can post a rating like this:</p>
<div class="highlight"><pre><span></span><code>curl -X POST &quot;http://localhost:8080/alfresco/s/someco/rating?id=802d6f27-82ec-4c9c-8e29-9b6e4a3401ef&amp;rating=5&amp;user=jpotts&amp;guest=true&quot;
</code></pre></div>
<p>That <code>id</code> is from the node reference of an existing whitepaper.</p>
<p>Running this returns:</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;rating&quot;</span><span class="w"> </span><span class="p">:</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">         </span><span class="nt">&quot;node&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;802d6f27-82ec-4c9c-8e29-9b6e4a3401ef&quot;</span><span class="p">,</span>
<span class="w">         </span><span class="nt">&quot;rating&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;5&quot;</span><span class="p">,</span>
<span class="w">         </span><span class="nt">&quot;user&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;jpotts&quot;</span>
<span class="w">        </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Assuming everything is okay, you now have web scripts that can retrieve as well
as create content in the repository. Let's finish up the custom ratings API by
creating a web script that deletes ratings.</p>
<h2 id="deleting-ratings">Deleting ratings<a class="headerlink" href="#deleting-ratings" title="Permanent link">&para;</a></h2>
<p>This should be old hat by now. Creating a web script to delete the ratings
associated with a specific whitepaper is similar to the other web scripts, it's
just that this one is invoked with the DELETE HTTP method. Let's look at the
descriptor and the controller.</p>
<h3 id="step-1-configure-the-descriptor-to-restrict-the-web-script-to-administrators">Step 1: Configure the descriptor to restrict the web script to administrators<a class="headerlink" href="#step-1-configure-the-descriptor-to-restrict-the-web-script-to-administrators" title="Permanent link">&para;</a></h3>
<p>It seems rare that you would want to delete all ratings for a given node but
highly likely that if you are going to expose it, it should be for admins only.
So let's tell Alfresco that this web script can only by run by administrators.
The descriptor is named <a href="https://github.com/jpotts/alfresco-developer-series/blob/master/webscripts/webscripts-tutorial/webscripts-tutorial-platform/src/main/resources/alfresco/extension/templates/webscripts/com/someco/ratings/rating.delete.desc.xml">rating.delete.desc.xml</a>.
It lives in:</p>
<div class="highlight"><pre><span></span><code>$TUTORIAL_HOME/webscripts-tutorial-platform/src/main/resources/alfresco/extension/templates/webscripts/com/someco/ratings
</code></pre></div>
<p>To restrict the web script to administrators, set the <code>authentication</code> element
like this:</p>
<div class="highlight"><pre><span></span><code>&lt;authentication&gt;admin&lt;/authentication&gt;
</code></pre></div>
<p>Now only administrators can execute the web script.</p>
<h3 id="step-2-write-the-controller_1">Step 2: Write the controller<a class="headerlink" href="#step-2-write-the-controller_1" title="Permanent link">&para;</a></h3>
<p>As in previous examples, the controller JavaScript, <a href="https://github.com/jpotts/alfresco-developer-series/blob/master/webscripts/webscripts-tutorial/webscripts-tutorial-platform/src/main/resources/alfresco/extension/templates/webscripts/com/someco/ratings/rating.delete.js">rating.delete.js</a>,
reads and checks the arguments then calls a function. In this case it is the
<code>deleteRatings()</code> function that already exists in the rating.js file packaged in
the behavior-tutorial project in the behavior-tutorial-platform module.
The body of the function is:</p>
<div class="highlight"><pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">deleteRatings</span><span class="p">(</span><span class="nx">curNode</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// check the parent to make sure it has the right aspect</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">curNode</span><span class="p">.</span><span class="nx">hasAspect</span><span class="p">(</span><span class="s2">&quot;{http://www.someco.com/model/content/1.0}rateable&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// continue, this is what we want</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">logger</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Node did not have rateable aspect.&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="k">return</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="c1">// get the node&#39;s children</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">children</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">curNode</span><span class="p">.</span><span class="nx">children</span><span class="p">;</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">children</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">children</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="err">\</span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">logger</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Found children...iterating&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="nx">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="nx">children</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">var</span><span class="w"> </span><span class="nx">child</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">children</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
<span class="w">            </span><span class="nx">logger</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Removing child: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">child</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
<span class="w">            </span><span class="nx">child</span><span class="p">.</span><span class="nx">remove</span><span class="p">();</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>The script bails if the node doesn't have the rateable aspect (because there
wouldn't be any ratings). Otherwise, it grabs the children and deletes them.
Note the important assumption that the only children that exist are ratings. If
there's a possibility of other child associations, you'd obviously want to be
more discriminating.</p>
<h3 id="step-3-create-the-view">Step 3: Create the view<a class="headerlink" href="#step-3-create-the-view" title="Permanent link">&para;</a></h3>
<p>The delete web script has only a single view, <a href="https://github.com/jpotts/alfresco-developer-series/blob/master/webscripts/webscripts-tutorial/webscripts-tutorial-platform/src/main/resources/alfresco/extension/templates/webscripts/com/someco/ratings/rating.delete.html.ftl">rating.delete.html.ftl</a>,
and it is pretty boring. It echos back the ID of the object from which the
ratings were deleted, then provides a link back to the GET rating web script.</p>
<h3 id="testing-the-delete-web-script-with-curl">Testing the delete web script with curl<a class="headerlink" href="#testing-the-delete-web-script-with-curl" title="Permanent link">&para;</a></h3>
<p>There is no reason to shutdown Alfresco when you deploy this web script. For
example, in IntelliJ, I can just do a "Build Project" then re-run the web script.
If your change isn't there try using the web scripts console to refresh the list
of web scripts and you are ready to test.</p>
<p>One way to test this web script is to use curl. For example, if you know the
node reference of a piece of content with ratings, you can grab the ID part of
the nodeRef and invoke the DELETE web script like this:</p>
<div class="highlight"><pre><span></span><code>curl -uadmin:admin -X DELETE &quot;http://localhost:8080/alfresco/s/someco/rating/delete.html?id=802d6f27-82ec-4c9c-8e29-9b6e4a3401ef&quot;
</code></pre></div>
<p>Notice that the admin username and password are being passed in. The web script
requires an administrator to execute it.</p>
<p>If everything goes as planned you will see something similar to:</p>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Successfully deleted ratings for node: 802d6f27-82ec-4c9c-8e29-9b6e4a3401ef<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;/alfresco/s/someco/rating.html?id=802d6f27-82ec-4c9c-8e29-9b6e4a3401ef&quot;</span><span class="p">&gt;</span>Back to Ratings<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div>
<p>If you then visit the GET rating web script, either in your browser or through
curl, you'll see the object no longer has any ratings.</p>
<h2 id="example-summary">Example summary<a class="headerlink" href="#example-summary" title="Permanent link">&para;</a></h2>
<p>You've seen how to implement two GET web scripts (one that retrieves a list of
whitepapers and that retrieves a specific rating), a POST web script for
creating new ratings, and a DELETE web script for clearing out ratings. At this
point SomeCo has everything they need to build a front-end that talks to the
Alfresco repository via REST.</p>
<p>One piece of functionality I didn't show, but I've included in the source, is
the ability for an optional “user” argument to be passed in to the two GET
scripts. When present, the web script will return the last rating for the
specified user in addition to the overall rating data.</p>
<h1 id="invoking-web-scripts-with-ajax">Invoking web scripts with ajax<a class="headerlink" href="#invoking-web-scripts-with-ajax" title="Permanent link">&para;</a></h1>
<p>SomeCo's custom ratings API is in place but it would be nice to have a user
interface for creating ratings. In this section, you'll add a little five star
ratings widget to the rating.get.html.ftl template that uses client-side
JavaScript to make POSTs against the rating web script to create ratings.</p>
<p>If you have no interest in calling web scripts from client-side JavaScript you
can safely skip this entire section. Otherwise, read on.</p>
<p>Here is what the HTML view of the rating GET web script should look like when
this is working:</p>
<p><img alt="Displaying the ratings data for a specific node" src="../images/rating-html.png" /></p>
<p>The purpose of the rating widget is two-fold. First, it graphically displays the
average rating for a whitepaper. Second, each star in the widget is hot. When
one of the stars is clicked, an asynchronous post is made to the rating POST web
script which causes a new rating object to get created.</p>
<p>The name of the person submitting the rating would normally be passed in based
on some sort of credential, maybe from a portal session or a cookie. In this
test form, the rater's name is specified as a plain text field.</p>
<p>To implement this you'll need to:</p>
<ol>
<li>Copy the client-side assets the widget needs into the appropriate folder in
the AMP.</li>
<li>Modify the GET rating web script with client-side JavaScript that
instantiates the widget and calls the POST web script when it is clicked.</li>
</ol>
<h2 id="step-1-copy-the-client-side-assets-into-the-project">Step 1: Copy the client-side assets into the project<a class="headerlink" href="#step-1-copy-the-client-side-assets-into-the-project" title="Permanent link">&para;</a></h2>
<p>I found a five star widget online written in client-side JavaScript and used
that as a starting point (the original site has gone offline). The widget
leverages the <a href="http://prototypejs.org/">prototype</a> JavaScript library.</p>
<p>The first step is to copy the JavaScript and images into the AMP project
structure. The images reside in:</p>
<div class="highlight"><pre><span></span><code>$TUTORIAL_HOME/webscripts-tutorial-platform/src/main/amp/web/images
</code></pre></div>
<p>And the client-side JavaScript resides in:</p>
<div class="highlight"><pre><span></span><code>$TUTORIAL_HOME/webscripts-tutorial-platform/src/main/amp/web/scripts
</code></pre></div>
<p>Next you'll modify the rating web script to leverage these.</p>
<h2 id="step-2-modify-the-get-rating-web-script-to-include-client-side-javascript">Step 2: Modify the GET rating web script to include client-side JavaScript<a class="headerlink" href="#step-2-modify-the-get-rating-web-script-to-include-client-side-javascript" title="Permanent link">&para;</a></h2>
<p>Recall that the FreeMarker view for the rating GET web script resides in:</p>
<div class="highlight"><pre><span></span><code>$TUTORIAL_HOME/webscripts-tutorial-platform/src/main/resources/alfresco/extension/templates/webscripts/com/someco/ratings
</code></pre></div>
<p>The file is called <a href="https://github.com/jpotts/alfresco-developer-series/blob/master/webscripts/webscripts-tutorial/webscripts-tutorial-platform/src/main/resources/alfresco/extension/templates/webscripts/com/someco/ratings/rating.get.html.ftl">rating.get.html.ftl</a>, but let's focus on the main body of the HTML first. Here it is:</p>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;${url.serviceContext}/someco/whitepapers.html?guest=true&quot;</span><span class="p">&gt;</span>Back to the list<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span> of whitepapers<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Node: ${args.id}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Average: ${rating.average!&#39;&#39;}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span># of Ratings: ${rating.count!&#39;&#39;}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="err">&lt;</span>#if (rating.user &gt; 0)&gt;
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>User rating: ${rating.user!&#39;&#39;}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="err">&lt;</span>/#if&gt;
<span class="p">&lt;</span><span class="nt">form</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;login&quot;</span><span class="p">&gt;</span>
    Rater:<span class="p">&lt;</span><span class="nt">input</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;userId&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">input</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
Rating: <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;rating&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;rating_${args.id}&quot;</span> <span class="na">style</span><span class="o">=</span><span class="s">&quot;display:inline&quot;</span><span class="p">&gt;</span>${rating.average!&#39;0&#39;}<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;#&quot;</span> <span class="na">onclick</span><span class="o">=</span><span class="s">deleteRatings(&quot;${args.id}&quot;)</span><span class="p">&gt;</span>Delete ratings<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span> for this node<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</code></pre></div>
<p>This is all basic HTML/FreeMarker stuff you've seen before. The last line sets
up a <code>div</code> for the ratings widget. The <code>id</code> of the <code>div</code> uses the node ref of
the whitepaper. This allows multiple ratings widgets to be on the same page and
makes it easy for the JavaScript to pass the node ref on to the rating POST web
script.</p>
<p>Now take a look at the inline JavaScript. I'm going to omit some of the less
interesting functions and just show the functions related to posting
ratings.</p>
<div class="highlight"><pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">submitRating</span><span class="p">(</span><span class="nx">evt</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">tmp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Event</span><span class="p">.</span><span class="nx">element</span><span class="p">(</span><span class="nx">evt</span><span class="p">).</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">).</span><span class="nx">substr</span><span class="p">(</span><span class="mf">5</span><span class="p">);</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">widgetId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tmp</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">tmp</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">));</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">starNbr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tmp</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="nx">tmp</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="o">+</span><span class="mf">1</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">login</span><span class="p">.</span><span class="nx">userId</span><span class="p">.</span><span class="nx">value</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">undefined</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">login</span><span class="p">.</span><span class="nx">userId</span><span class="p">.</span><span class="nx">value</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">curUser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">login</span><span class="p">.</span><span class="nx">userId</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">curUser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;jpotts&quot;</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">postRating</span><span class="p">(</span><span class="nx">widgetId</span><span class="p">,</span><span class="w"> </span><span class="nx">starNbr</span><span class="p">,</span><span class="w"> </span><span class="nx">curUser</span><span class="p">);</span>
<span class="p">}</span><span class="w">           </span>

<span class="kd">function</span><span class="w"> </span><span class="nx">postRating</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span><span class="w"> </span><span class="nx">rating</span><span class="p">,</span><span class="w"> </span><span class="nx">user</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">receiveReq</span><span class="p">.</span><span class="nx">readyState</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">4</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">receiveReq</span><span class="p">.</span><span class="nx">readyState</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">receiveReq</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s2">&quot;POST&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;${url.serviceContext}/someco/rating?id=&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">id</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot;&amp;rating=&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">rating</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot;&amp;guest=true&amp;user=&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">user</span><span class="p">,</span><span class="w"> </span><span class="kc">true</span><span class="p">);</span>
<span class="w">        </span><span class="nx">receiveReq</span><span class="p">.</span><span class="nx">onreadystatechange</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">handleRatingPosted</span><span class="p">;</span>
<span class="w">        </span><span class="nx">receiveReq</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">function</span><span class="w"> </span><span class="nx">handleRatingPosted</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">receiveReq</span><span class="p">.</span><span class="nx">readyState</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">4</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">reload</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Those of you familiar with AJAX techniques may be wondering why I didn't use the
prototype library to make the post--it is already already being used with the
rating widget. I had trouble getting prototype to play nicely with the web
script framework and this particular version of prototype is quite old, so
rather than spend time upgrading the library and debugging the problem, I chose
to use the lower-level <code>XMLHttpRequest</code>.</p>
<h2 id="dealing-with-the-cross-domain-scripting-limitation">Dealing with the cross-domain scripting limitation<a class="headerlink" href="#dealing-with-the-cross-domain-scripting-limitation" title="Permanent link">&para;</a></h2>
<p>In this example, the Alfresco server and the server serving up the page with the
ratings widget are the same machine. In production, Alfresco and the front-end
might be different machines. Browsers hitting the front-end web site will be
able to make AJAX calls to the front-end servers but not the Alfresco server.
This known as the “cross-domain scripting limitation”. Ways to deal with the
limitation are widely documented on the Internet. The web script framework does
provide a callback mechanism if you choose to go that route.</p>
<h1 id="conclusion">Conclusion<a class="headerlink" href="#conclusion" title="Permanent link">&para;</a></h1>
<p>This tutorial provided an introduction to the Alfresco web script framework. It
began with a very simple "Hello World" web script deployed to the content
repository and then gradually moved to more complex examples.</p>
<p>By the end of the tutorial you created a REST API for retrieving whitepapers,
getting the average rating for a specific whitepaper, posting new ratings for a
given whitepaper, and deleting all ratings for a specific whitepaper.</p>
<p>You saw how to use both JavaScript and Java to implement web script controller
logic. You used FreeMarker to render web script output in HTML as well as JSON.</p>
<p>Finally, you saw one example of how to invoke web scripts from client-side
JavaScript by implementing a five star ratings widget that creates new ratings
when clicked. That discussion included options for working around the
cross-domain scripting limitation.</p>
<h1 id="things-to-explore-on-your-own">Things to Explore on Your Own<a class="headerlink" href="#things-to-explore-on-your-own" title="Permanent link">&para;</a></h1>
<p>There are still topics left to explore. For now, that's up to you. Here are some
suggestions for things you might want to investigate further...</p>
<ul>
<li>Web scripts are almost self-documenting. Help yourself and your team by giving
web scripts a meaningful <code>description</code> in the descriptor XML. You can also set
the <code>family</code> element to group web scripts to make them easier to find in the web
script console.</li>
<li>Web scripts can have an associated "config" file. This is useful when you
would like administrators to be able to modify variables or settings for your
web script without risking inadvertent changes to your code.</li>
<li>The individual files that make up a web script can be overridden. For example,
suppose you want to change how the HTML view of an out-of-the-box web script
works but you don't want to change its descriptor, controllers, or other views.
If you create a file in your project under the extension directory that has the
same name and file path as Alfresco's, yours will take precedence.</li>
<li>You can use web scripts to create portlets for portlet containers like like
Liferay or JBoss Portal.</li>
<li>This example showed web scripts running in the "repo" tier but the "share"
tier also includes the web script framework. Web scripts are a fundamental
building block of the Alfresco Share user interface. Any custom work you do in
Share will most likely involve web scripts at some point.</li>
<li>These examples showed the common case where the web script framework sends the
response to the requester in its entirety. But you can also write web scripts
that stream their responses.</li>
<li>With a little bit of work you can write web script controllers in other
languages besides JavaScript and Java.</li>
</ul>
<p>The number of web scripts shipped with Alfresco has grown tremendously over the
years. Before writing your own, browse the web script index to see what you
might be able to leverage. Be careful, though. Not all out-of-the-box web
scripts are meant for public use. The web script console can sort web scripts by
"lifecycle". Avoid web scripts marked "deprecated" or "internal".</p>
<h1 id="where-to-find-more-information">Where to Find More Information<a class="headerlink" href="#where-to-find-more-information" title="Permanent link">&para;</a></h1>
<ul>
<li>The complete source code for these examples is available on <a href="https://github.com/jpotts/alfresco-developer-series">GitHub</a>.</li>
<li>Official documentation for both Enterprise Edition and Community Edition is
available at <a href="http://docs.alfresco.com/">docs.alfresco.com</a>.</li>
<li>Ask questions about web scripts in the <a href="http://community.alfresco.com">community</a>.</li>
<li>If you are ready to cover new ground, try another <a href="https://ecmarchitect.com">ecmarchitect.com</a>
tutorial in the <a href="https://ecmarchitect.com/alfresco-developer-series">Alfresco Developer Series</a>.
The most logical next step is the <a href="https://ecmarchitect.com/alfresco-developer-series-tutorials/workflow/tutorial/tutorial.html">Custom Advanced Workflows</a> tutorial.</li>
<li>Learn more about FreeMarker at <a href="http://freemarker.sourceforge.net/">freemarker.sourceforge.net</a>.</li>
<li>Learn more about JSON at <a href="http://www.json.org/">json.org</a></li>
</ul>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.instant", "navigation.sections", "navigation.top", "content.code.copy"], "search": "../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>